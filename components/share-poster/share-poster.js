"use strict";const e=require("../../common/vendor.js"),t=require("../../utils/common.js"),o=require("../../app/api/system.js");if(require("../../utils/pages.js"),require("../../app/stores/diy.js"),require("../../hooks/useLogin.js"),require("../../utils/request.js"),require("../../stores/member.js"),require("../../app/api/member.js"),require("../../app/api/auth.js"),require("../../stores/config.js"),require("../../stores/system.js"),require("../../locale/index.js"),require("../../locale/i18n.js"),require("../../locale/language.js"),!Array){e.resolveComponent("u-popup")()}Math;const a=e.defineComponent({__name:"share-poster",props:{posterId:{type:String||Number,default:0},posterType:{type:String,default:""},posterParam:{type:Object,default:{}},copyUrl:{type:String,default:""},copyUrlParam:{type:String,default:""}},emits:["close"],setup(a,{expose:s,emit:r}){const l=a,i=e.ref(!1),u=e.ref(!1),n=e.ref(!1),p=e.ref(""),m=()=>{if(p.value)u.value=!1,n.value=!0;else{u.value=!0,n.value=!1;let e={id:l.posterId,type:l.posterType,param:l.posterParam},a=Date.parse(new Date);o.getPoster(e).then((e=>{p.value=e.data&&t.img(e.data)||"";let o=Date.parse(new Date)-a;o<2200?setTimeout((()=>{u.value=!1,n.value=!0}),2200-o):(u.value=!1,n.value=!0)})).catch((()=>{g()}))}},d=e.ref(!1),c=()=>{d.value=!1},v=e.ref(0);let f={};f=e.index.getMenuButtonBoundingClientRect(),v.value=f.top+f.height+"px";const g=()=>{i.value=!1,u.value=!1,n.value=!1,r("close")};return s({openShare:()=>{i.value=!0,m()},loadPoster:m}),(o,a)=>e.e({a:u.value},u.value?{b:e.unref(t.img)("addon/shop/poster_animation.gif")}:{},{c:n.value},n.value?{d:e.unref(t.img)(p.value)}:{},{e:v.value,f:e.o((o=>(()=>{let o=t.img(p.value);e.index.downloadFile({url:o,success:t=>{"downloadFile:ok"==t.errMsg&&e.index.saveImageToPhotosAlbum({filePath:t.tempFilePath,success:()=>{e.index.showToast({title:"保存成功",icon:"none"})},fail:t=>{if(104==t.errno){let t="用户未授权隐私权限，将图像保存到相册失败";e.index.showToast({title:t,icon:"none"})}else if("saveImageToPhotosAlbum:fail auth deny"==t.errMsg||"saveImageToPhotosAlbum:fail:auth denied"==t.errMsg)d.value=!0;else if("saveImageToPhotosAlbum:fail cancel"==t.errMsg){let t="用户取消将图片保存到相册";e.index.showToast({title:t,icon:"none"})}else e.index.showToast({title:t.errMsg,icon:"none"})}})},fail:t=>{e.index.showToast({title:t.errMsg,icon:"none"})}})})())),g:e.o(g),h:e.o((()=>{})),i:e.o(g),j:e.p({show:i.value,type:"bottom",overlayOpacity:"0.8"}),k:e.o(c),l:e.o(c),m:e.o((e=>d.value=!1)),n:e.p({show:d.value,mode:"center",round:10,closeable:!0,"safe-area-inset-bottom":!1}),o:e.o((()=>{}))})}}),s=e._export_sfc(a,[["__scopeId","data-v-4703c7bd"]]);tt.createComponent(s);
