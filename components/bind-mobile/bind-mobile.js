"use strict";const e=require("../../common/vendor.js"),o=require("../../locale/index.js"),r=require("../../app/api/member.js"),n=require("../../app/api/auth.js"),t=require("../../stores/member.js"),i=require("../../stores/config.js"),s=require("../../utils/common.js"),u=require("../../hooks/useLogin.js");if(require("../../locale/i18n.js"),require("../../locale/language.js"),require("../../utils/pages.js"),require("../../stores/system.js"),require("../../app/api/system.js"),require("../../utils/request.js"),require("../../app/stores/diy.js"),!Array){(e.resolveComponent("u-form-item")+e.resolveComponent("sms-code")+e.resolveComponent("u-checkbox")+e.resolveComponent("u-checkbox-group")+e.resolveComponent("u-form")+e.resolveComponent("u-popup"))()}Math||((()=>"../../node-modules/uview-plus/components/u-form-item/u-form-item.js")+(()=>"../sms-code/sms-code.js")+(()=>"../../node-modules/uview-plus/components/u-checkbox/u-checkbox.js")+(()=>"../../node-modules/uview-plus/components/u-checkbox-group/u-checkbox-group.js")+(()=>"../../node-modules/uview-plus/components/u-form/u-form.js")+(()=>"../../node-modules/uview-plus/components/u-popup/u-popup.js"))();const a=e.defineComponent({__name:"bind-mobile",setup(a,{expose:l}){const m=e.ref(!1),d=t.useMemberStore(),c=e.computed((()=>d.info)),p=e.computed((()=>i.useConfigStore().login)),g=e.ref(!1),b=e.ref(!1),v=e.reactive({mobile:"",mobile_code:"",mobile_key:""}),f=e.ref(!0);e.onMounted((()=>{setTimeout((()=>{f.value=!1}),800),e.index.getStorageSync("pid")&&Object.assign(v,{pid:e.index.getStorageSync("pid")}),e.index.getStorageSync("openid")&&Object.assign(v,{openid:e.index.getStorageSync("openid")}),e.index.getStorageSync("unionid")&&Object.assign(v,{unionid:e.index.getStorageSync("unionid")}),e.index.getStorageSync("nickname")&&Object.assign(v,{nickname:e.index.getStorageSync("nickname")}),e.index.getStorageSync("avatar")&&Object.assign(v,{headimg:e.index.getStorageSync("avatar")})}));const h={mobile:[{type:"string",required:!0,message:o.t("mobilePlaceholder"),trigger:["blur","change"]},{validator(o,r,n){e.index.$u.test.mobile(r)?n():n(new Error("请输入正确的手机号"))},message:o.t("mobileError"),trigger:["change","blur"]}],mobile_code:{type:"string",required:!0,message:o.t("codePlaceholder"),trigger:["blur","change"]}},y=()=>{b.value=!b.value},j=e.ref(null),x=()=>{j.value.validate().then((()=>{if(!b.value&&p.value.agreement_show)return void e.index.showToast({title:o.t("isAgreeTips"),icon:"none"});if(g.value)return;g.value=!0;(c.value?r.bindMobile:n.mobileLogin)(v).then((o=>{c.value?(d.getMemberInfo(),c.value.mobile&&e.index.removeStorageSync("isBindMobile")):(d.setToken(o.data.token),u.useLogin().handleLoginBack()),m.value=!1})).catch((()=>{g.value=!1}))}))};return l({open:()=>{m.value=!0}}),(r,n)=>e.e({a:e.t(e.unref(o.t)("bindMobile")),b:e.unref(o.t)("mobilePlaceholder"),c:f.value,d:v.mobile,e:e.o((e=>v.mobile=e.detail.value)),f:e.p({label:"",prop:"mobile",borderBottom:!0}),g:e.unref(o.t)("codePlaceholder"),h:f.value,i:v.mobile_code,j:e.o((e=>v.mobile_code=e.detail.value)),k:e.unref(p).agreement_show},e.unref(p).agreement_show?{l:e.o((e=>v.mobile_key=e)),m:e.p({mobile:v.mobile,type:"login",isAgree:b.value,modelValue:v.mobile_key})}:{n:e.o((e=>v.mobile_key=e)),o:e.p({mobile:v.mobile,type:"login",modelValue:v.mobile_key})},{p:e.p({label:"",prop:"mobile_code",borderBottom:!0}),q:e.unref(p).agreement_show},e.unref(p).agreement_show?{r:e.p({activeColor:"var(--primary-color)",checked:b.value,shape:"circle",size:"28rpx"}),s:e.o(y),t:e.t(e.unref(o.t)("agreeTips")),v:e.t(e.unref(o.t)("privacyAgreement")),w:e.o((o=>e.unref(s.redirect)({url:"/app/pages/auth/agreement?key=privacy"}))),x:e.t(e.unref(o.t)("and")),y:e.t(e.unref(o.t)("userAgreement")),z:e.o((o=>e.unref(s.redirect)({url:"/app/pages/auth/agreement?key=service"}))),A:e.o(y)}:{},{B:e.t(e.unref(o.t)("bind")),C:g.value?1:"",D:g.value,E:e.o(x),F:e.sr(j,"6fde1d0f-1,6fde1d0f-0",{k:"formRef"}),G:e.p({labelPosition:"left",model:v,errorType:"toast",rules:h}),H:e.o((()=>{})),I:e.o((e=>m.value=!1)),J:e.p({show:m.value,mode:"center",round:10,closeable:!0,safeAreaInsetBottom:!1,zIndex:"10086"})})}}),l=e._export_sfc(a,[["__scopeId","data-v-6fde1d0f"]]);tt.createComponent(l);
