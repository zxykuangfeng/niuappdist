"use strict";const t=require("../../../common/vendor.js");function o(t,o){let i=this;i.version="1.3.7",i.options=t||{},i.isScrollBody=o||!1,i.isDownScrolling=!1,i.isUpScrolling=!1;let e=i.options.down&&i.options.down.callback;i.initDownScroll(),i.initUpScroll(),setTimeout((function(){(i.optDown.use||i.optDown.native)&&i.optDown.auto&&e&&(i.optDown.autoShowLoading?i.triggerDownScroll():i.optDown.callback&&i.optDown.callback(i)),i.isUpAutoLoad||setTimeout((function(){i.optUp.use&&i.optUp.auto&&!i.isUpAutoLoad&&i.triggerUpScroll()}),100)}),30)}o.prototype.extendDownScroll=function(t){o.extend(t,{use:!0,auto:!0,native:!1,autoShowLoading:!1,isLock:!1,offset:80,startTop:100,inOffsetRate:1,outOffsetRate:.2,bottomOffset:20,minAngle:45,textInOffset:"下拉刷新",textOutOffset:"释放更新",textLoading:"加载中 ...",textSuccess:"加载成功",textErr:"加载失败",beforeEndDelay:0,bgColor:"transparent",textColor:"gray",inited:null,inOffset:null,outOffset:null,onMoving:null,beforeLoading:null,showLoading:null,afterLoading:null,beforeEndDownScroll:null,endDownScroll:null,afterEndDownScroll:null,callback:function(t){t.resetUpScroll()}})},o.prototype.extendUpScroll=function(t){o.extend(t,{use:!0,auto:!0,isLock:!1,isBoth:!0,callback:null,page:{num:0,size:10,time:null},noMoreSize:5,offset:150,textLoading:"加载中 ...",textNoMore:"",bgColor:"transparent",textColor:"gray",inited:null,showLoading:null,showNoMore:null,hideUpScroll:null,errDistance:60,toTop:{src:null,offset:1e3,duration:300,btnClick:null,onShow:null,zIndex:9990,left:null,right:20,bottom:120,safearea:!1,width:72,radius:"50%"},empty:{use:!0,icon:null,tip:"~ 暂无相关数据 ~",btnText:"",btnClick:null,onShow:null,fixed:!1,top:"100rpx",zIndex:99},onScroll:!1})},o.extend=function(t,i){if(!t)return i;for(let e in i)if(null==t[e]){let n=i[e];t[e]=null!=n&&"object"==typeof n?o.extend({},n):n}else"object"==typeof t[e]&&o.extend(t[e],i[e]);return t},o.prototype.hasColor=function(t){if(!t)return!1;let o=t.toLowerCase();return"#fff"!=o&&"#ffffff"!=o&&"transparent"!=o&&"white"!=o},o.prototype.initDownScroll=function(){let t=this;t.optDown=t.options.down||{},!t.optDown.textColor&&t.hasColor(t.optDown.bgColor)&&(t.optDown.textColor="#fff"),t.extendDownScroll(t.optDown),t.isScrollBody&&t.optDown.native?t.optDown.use=!1:t.optDown.native=!1,t.downHight=0,t.optDown.use&&t.optDown.inited&&setTimeout((function(){t.optDown.inited(t)}),0)},o.prototype.touchstartEvent=function(t){this.optDown.use&&(this.startPoint=this.getPoint(t),this.startTop=this.getScrollTop(),this.startAngle=0,this.lastPoint=this.startPoint,this.maxTouchmoveY=this.getBodyHeight()-this.optDown.bottomOffset,this.inTouchend=!1)},o.prototype.touchmoveEvent=function(t){if(!this.optDown.use)return;let o=this,i=o.getScrollTop(),e=o.getPoint(t);if(e.y-o.startPoint.y>0&&(o.isScrollBody&&i<=0||!o.isScrollBody&&(i<=0||i<=o.optDown.startTop&&i===o.startTop))&&!o.inTouchend&&!o.isDownScrolling&&!o.optDown.isLock&&(!o.isUpScrolling||o.isUpScrolling&&o.optUp.isBoth)){if(o.startAngle||(o.startAngle=o.getAngle(o.lastPoint,e)),o.startAngle<o.optDown.minAngle)return;if(o.maxTouchmoveY>0&&e.y>=o.maxTouchmoveY)return o.inTouchend=!0,void o.touchendEvent();o.preventDefault(t);let i=e.y-o.lastPoint.y;o.downHight<o.optDown.offset?(1!==o.movetype&&(o.movetype=1,o.isDownEndSuccess=null,o.optDown.inOffset&&o.optDown.inOffset(o),o.isMoveDown=!0),o.downHight+=i*o.optDown.inOffsetRate):(2!==o.movetype&&(o.movetype=2,o.optDown.outOffset&&o.optDown.outOffset(o),o.isMoveDown=!0),o.downHight+=i>0?i*o.optDown.outOffsetRate:i),o.downHight=Math.round(o.downHight);let n=o.downHight/o.optDown.offset;o.optDown.onMoving&&o.optDown.onMoving(o,n,o.downHight)}o.lastPoint=e},o.prototype.touchendEvent=function(t){if(this.optDown.use)if(this.isMoveDown)this.downHight>=this.optDown.offset?this.triggerDownScroll():(this.downHight=0,this.endDownScrollCall(this)),this.movetype=0,this.isMoveDown=!1;else if(!this.isScrollBody&&this.getScrollTop()===this.startTop){if(this.getPoint(t).y-this.startPoint.y<0){this.getAngle(this.getPoint(t),this.startPoint)>80&&this.triggerUpScroll(!0)}}},o.prototype.getPoint=function(t){return t?t.touches&&t.touches[0]?{x:t.touches[0].pageX,y:t.touches[0].pageY}:t.changedTouches&&t.changedTouches[0]?{x:t.changedTouches[0].pageX,y:t.changedTouches[0].pageY}:{x:t.clientX,y:t.clientY}:{x:0,y:0}},o.prototype.getAngle=function(t,o){let i=Math.abs(t.x-o.x),e=Math.abs(t.y-o.y),n=Math.sqrt(i*i+e*e),s=0;return 0!==n&&(s=Math.asin(e/n)/Math.PI*180),s},o.prototype.triggerDownScroll=function(){this.optDown.beforeLoading&&this.optDown.beforeLoading(this)||(this.showDownScroll(),!this.optDown.native&&this.optDown.callback&&this.optDown.callback(this))},o.prototype.showDownScroll=function(){this.isDownScrolling=!0,this.optDown.native?(t.index.startPullDownRefresh(),this.showDownLoadingCall(0)):(this.downHight=this.optDown.offset,this.showDownLoadingCall(this.downHight))},o.prototype.showDownLoadingCall=function(t){this.optDown.showLoading&&this.optDown.showLoading(this,t),this.optDown.afterLoading&&this.optDown.afterLoading(this,t)},o.prototype.onPullDownRefresh=function(){this.isDownScrolling=!0,this.showDownLoadingCall(0),this.optDown.callback&&this.optDown.callback(this)},o.prototype.endDownScroll=function(){if(this.optDown.native)return this.isDownScrolling=!1,this.endDownScrollCall(this),void t.index.stopPullDownRefresh();let o=this,i=function(){o.downHight=0,o.isDownScrolling=!1,o.endDownScrollCall(o),o.isScrollBody||(o.setScrollHeight(0),o.scrollTo(0,0))},e=0;o.optDown.beforeEndDownScroll&&(e=o.optDown.beforeEndDownScroll(o),null==o.isDownEndSuccess&&(e=0)),"number"==typeof e&&e>0?setTimeout(i,e):i()},o.prototype.endDownScrollCall=function(){this.optDown.endDownScroll&&this.optDown.endDownScroll(this),this.optDown.afterEndDownScroll&&this.optDown.afterEndDownScroll(this)},o.prototype.lockDownScroll=function(t){null==t&&(t=!0),this.optDown.isLock=t},o.prototype.lockUpScroll=function(t){null==t&&(t=!0),this.optUp.isLock=t},o.prototype.initUpScroll=function(){let t=this;t.optUp=t.options.up||{use:!1},!t.optUp.textColor&&t.hasColor(t.optUp.bgColor)&&(t.optUp.textColor="#fff"),t.extendUpScroll(t.optUp),!1!==t.optUp.use&&(t.optUp.hasNext=!0,t.startNum=t.optUp.page.num+1,t.optUp.inited&&setTimeout((function(){t.optUp.inited(t)}),0))},o.prototype.onReachBottom=function(){this.isScrollBody&&!this.isUpScrolling&&!this.optUp.isLock&&this.optUp.hasNext&&this.triggerUpScroll()},o.prototype.onPageScroll=function(t){this.isScrollBody&&(this.setScrollTop(t.scrollTop),t.scrollTop>=this.optUp.toTop.offset?this.showTopBtn():this.hideTopBtn())},o.prototype.scroll=function(t,o){this.setScrollTop(t.scrollTop),this.setScrollHeight(t.scrollHeight),null==this.preScrollY&&(this.preScrollY=0),this.isScrollUp=t.scrollTop-this.preScrollY>0,this.preScrollY=t.scrollTop,this.isScrollUp&&this.triggerUpScroll(!0),t.scrollTop>=this.optUp.toTop.offset?this.showTopBtn():this.hideTopBtn(),this.optUp.onScroll&&o&&o()},o.prototype.triggerUpScroll=function(t){if(!this.isUpScrolling&&this.optUp.use&&this.optUp.callback){if(!0===t){let t=!1;if(!this.optUp.hasNext||this.optUp.isLock||this.isDownScrolling||this.getScrollBottom()<=this.optUp.offset&&(t=!0),!1===t)return}this.showUpScroll(),this.optUp.page.num++,this.isUpAutoLoad=!0,this.num=this.optUp.page.num,this.size=this.optUp.page.size,this.time=this.optUp.page.time,this.optUp.callback(this)}},o.prototype.showUpScroll=function(){this.isUpScrolling=!0,this.optUp.showLoading&&this.optUp.showLoading(this)},o.prototype.showNoMore=function(){this.optUp.hasNext=!1,this.optUp.showNoMore&&this.optUp.showNoMore(this)},o.prototype.hideUpScroll=function(){this.optUp.hideUpScroll&&this.optUp.hideUpScroll(this)},o.prototype.endUpScroll=function(t){null!=t&&(t?this.showNoMore():this.hideUpScroll()),this.isUpScrolling=!1},o.prototype.resetUpScroll=function(t){if(this.optUp&&this.optUp.use){let o=this.optUp.page;this.prePageNum=o.num,this.prePageTime=o.time,o.num=this.startNum,o.time=null,this.isDownScrolling||!1===t||(null==t?(this.removeEmpty(),this.showUpScroll()):this.showDownScroll()),this.isUpAutoLoad=!0,this.num=o.num,this.size=o.size,this.time=o.time,this.optUp.callback&&this.optUp.callback(this)}},o.prototype.setPageNum=function(t){this.optUp.page.num=t-1},o.prototype.setPageSize=function(t){this.optUp.page.size=t},o.prototype.endByPage=function(t,o,i){let e;this.optUp.use&&null!=o&&(e=this.optUp.page.num<o),this.endSuccess(t,e,i)},o.prototype.endBySize=function(t,o,i){let e;if(this.optUp.use&&null!=o){e=(this.optUp.page.num-1)*this.optUp.page.size+t<o}this.endSuccess(t,e,i)},o.prototype.endSuccess=function(t,o,i){let e=this;if(e.isDownScrolling&&(e.isDownEndSuccess=!0,e.endDownScroll()),e.optUp.use){let n;if(null!=t){let s=e.optUp.page.num,l=e.optUp.page.size;if(1===s&&i&&(e.optUp.page.time=i),t<l||!1===o)if(e.optUp.hasNext=!1,0===t&&1===s)n=!1,e.showEmpty();else{n=!((s-1)*l+t<e.optUp.noMoreSize),e.removeEmpty()}else n=!1,e.optUp.hasNext=!0,e.removeEmpty()}e.endUpScroll(n)}},o.prototype.endErr=function(t){if(this.isDownScrolling){this.isDownEndSuccess=!1;let t=this.optUp.page;t&&this.prePageNum&&(t.num=this.prePageNum,t.time=this.prePageTime),this.endDownScroll()}this.isUpScrolling&&(this.optUp.page.num--,this.endUpScroll(!1),this.isScrollBody&&0!==t&&(t||(t=this.optUp.errDistance),this.scrollTo(this.getScrollTop()-t,0)))},o.prototype.showEmpty=function(){this.optUp.empty.use&&this.optUp.empty.onShow&&this.optUp.empty.onShow(!0)},o.prototype.removeEmpty=function(){this.optUp.empty.use&&this.optUp.empty.onShow&&this.optUp.empty.onShow(!1)},o.prototype.showTopBtn=function(){this.topBtnShow||(this.topBtnShow=!0,this.optUp.toTop.onShow&&this.optUp.toTop.onShow(!0))},o.prototype.hideTopBtn=function(){this.topBtnShow&&(this.topBtnShow=!1,this.optUp.toTop.onShow&&this.optUp.toTop.onShow(!1))},o.prototype.getScrollTop=function(){return this.scrollTop||0},o.prototype.setScrollTop=function(t){this.scrollTop=t},o.prototype.scrollTo=function(t,o){this.myScrollTo&&this.myScrollTo(t,o)},o.prototype.resetScrollTo=function(t){this.myScrollTo=t},o.prototype.getScrollBottom=function(){return this.getScrollHeight()-this.getClientHeight()-this.getScrollTop()},o.prototype.getStep=function(t,o,i,e,n){let s=o-t;if(0===e||0===s)return void(i&&i(o));let l=(e=e||300)/(n=n||30),p=s/l,r=0,h=setInterval((function(){r<l-1?(t+=p,i&&i(t,h),r++):(i&&i(o,h),clearInterval(h))}),n)},o.prototype.getClientHeight=function(t){let o=this.clientHeight||0;return 0===o&&!0!==t&&(o=this.getBodyHeight()),o},o.prototype.setClientHeight=function(t){this.clientHeight=t},o.prototype.getScrollHeight=function(){return this.scrollHeight||0},o.prototype.setScrollHeight=function(t){this.scrollHeight=t},o.prototype.getBodyHeight=function(){return this.bodyHeight||0},o.prototype.setBodyHeight=function(t){this.bodyHeight=t},o.prototype.preventDefault=function(t){t&&t.cancelable&&!t.defaultPrevented&&t.preventDefault()},exports.MeScroll=o;
