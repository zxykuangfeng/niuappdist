"use strict";const e=require("../../common/vendor.js"),a=require("../../locale/index.js"),t=require("../../app/api/pay.js"),r=require("../../utils/common.js");if(require("../../utils/request.js"),require("../../locale/i18n.js"),require("../../locale/language.js"),require("../../utils/pages.js"),require("../../stores/system.js"),require("../../app/api/system.js"),require("../../stores/config.js"),require("../../app/api/auth.js"),require("../../app/stores/diy.js"),require("../../hooks/useLogin.js"),require("../../stores/member.js"),require("../../app/api/member.js"),!Array){(e.resolveComponent("u-image")+e.resolveComponent("u-icon")+e.resolveComponent("u-popup"))()}Math||((()=>"../../node-modules/uview-plus/components/u-image/u-image.js")+(()=>"../../node-modules/uview-plus/components/u-icon/u-icon.js")+(()=>"../../node-modules/uview-plus/components/u-popup/u-popup.js"))();const o=e.defineComponent({__name:"pay",emits:["close","confirm"],setup(o,{expose:n,emit:i}){const u=e.ref(!1),p=e.ref(!1),s=e.ref(null),l=e.ref(""),d=()=>{var o,n,i,u;if(!e.index.$u.test.isEmpty(l.value))return"friendspay"==l.value?(r.redirect({url:"/app/pages/friendspay/share",param:{id:null==(o=s.value)?void 0:o.trade_id,type:null==(n=s.value)?void 0:n.trade_type},mode:"redirectTo"}),!1):void(p.value||(p.value=!0,t.pay({trade_type:null==(i=s.value)?void 0:i.trade_type,trade_id:null==(u=s.value)?void 0:u.trade_id,type:l.value,openid:e.index.getStorageSync("openid")||""}).then((a=>{switch(l.value){case"wechatpay":e.index.requestPayment({provider:"wxpay",...a.data,success:e=>{y()},fail:e=>{p.value=!1}});break;case"alipay":break;default:if(a.data.url)return void r.redirect({url:a.data.url,param:a.data.param||{},mode:"redirectTo"});y()}})).catch((()=>{p.value=!1}))));e.index.showToast({title:a.t("pay.notHavePayType"),icon:"none"})};e.index.$on("checkIsReturnAfterPayment",(()=>{const a=e.index.getStorageSync("paymenting");e.index.getStorageSync("paymenting")&&r.redirect({url:"/app/pages/pay/result",param:{trade_type:a.trade_type,trade_id:a.trade_id},mode:"redirectTo",success(){e.index.removeStorageSync("paymenting")}})}));const c=e.ref(!1),y=()=>{var e,a;i("confirm"),r.redirect({url:"/app/pages/pay/result",param:{trade_type:null==(e=s.value)?void 0:e.trade_type,trade_id:null==(a=s.value)?void 0:a.trade_id},mode:"redirectTo"})},m=()=>{e.index.removeStorageSync("paymenting"),u.value=!1,i("close")};return n({open:(r,o,n="",i="")=>{if(c.value)return;c.value=!0,e.index.setStorageSync("payReturn",encodeURIComponent(n));const p={};i&&(p.scene=i),t.getPayInfo(r,o,p).then((t=>{let{data:r}=t;s.value=r,e.index.$u.test.isEmpty(r)?e.index.showToast({title:a.t("pay.notObtainedInfo"),icon:"none"}):0!=r.money?(l.value=r.pay_type_list[0]?r.pay_type_list[0].key:"",u.value=!0,c.value=!1):y()})).catch((()=>{c.value=!1}))}}),(t,o)=>e.e({a:s.value},s.value?e.e({b:e.t(e.unref(a.t)("pay.payTitle")),c:e.t(e.unref(a.t)("currency")),d:e.t(e.unref(r.moneyFormat)(s.value.money)),e:e.t(e.unref(a.t)("pay.orderInfo")),f:e.t(s.value.body),g:s.value.pay_type_list.length},s.value.pay_type_list.length?{h:e.f(s.value.pay_type_list,((a,t,o)=>e.e({a:"92acc534-1-"+o+",92acc534-0",b:e.p({src:e.unref(r.img)(a.icon),width:"50rpx",height:"50rpx"}),c:e.t(a.name),d:a.key==l.value},a.key==l.value?{e:"92acc534-2-"+o+",92acc534-0",f:e.p({name:"checkbox-mark",color:"var(--primary-color)"})}:{},{g:t,h:e.o((e=>l.value=a.key))})))}:{i:e.t(e.unref(a.t)("pay.notHavePayType"))},{j:e.t(e.unref(a.t)("pay.confirmPay")),k:p.value,l:e.o(d),m:e.o((()=>{}))}):{},{n:e.o(m),o:e.p({show:u.value,round:10,closeable:!0,bgColor:"#fff",zIndex:"10081",closeOnClickOverlay:!1})})}}),n=e._export_sfc(o,[["__scopeId","data-v-92acc534"]]);tt.createComponent(n);
