"use strict";const e=require("../../common/vendor.js"),o=require("../../hooks/useSendSms.js"),t=require("../../hooks/useCaptcha.js"),r=require("../../locale/index.js");if(require("../../app/api/system.js"),require("../../utils/request.js"),require("../../stores/member.js"),require("../../utils/common.js"),require("../../utils/pages.js"),require("../../app/stores/diy.js"),require("../../hooks/useLogin.js"),require("../../stores/config.js"),require("../../app/api/auth.js"),require("../../stores/system.js"),require("../../app/api/member.js"),require("../../locale/i18n.js"),require("../../locale/language.js"),!Array){(e.resolveComponent("u-code")+e.resolveComponent("u-input")+e.resolveComponent("u-modal"))()}Math||((()=>"../../node-modules/uview-plus/components/u-code/u-code.js")+(()=>"../../node-modules/uview-plus/components/u-input/u-input.js")+(()=>"../../node-modules/uview-plus/components/u-modal/u-modal.js"))();const s=e.defineComponent({__name:"sms-code",props:{mobile:String,type:String,isAgree:{type:Boolean,default:!0},modelValue:{type:String,default:""}},emits:["update:modelValue"],setup(s,{emit:n}){const u=s,i=e.computed({get:()=>u.modelValue,set(e){n("update:modelValue",e)}}),a=e.ref(null),l=o.useSendSms(a),c=e.ref(!1),d=e.reactive({mobile:"",captcha_code:"",captcha_key:"",type:u.type}),p=t.useCaptcha(d),m=async()=>{if(a.value.canGetCode){if(d.mobile=u.mobile,!u.isAgree)return void e.index.showToast({title:r.t("isAgreeTips"),icon:"none"});if(e.index.$u.test.isEmpty(d.mobile))return void e.index.showToast({title:r.t("mobilePlaceholder"),icon:"none"});if(!e.index.$u.test.mobile(d.mobile))return void e.index.showToast({title:r.t("mobileError"),icon:"none"});await p.refresh(),c.value=!0}},f=async()=>{if(e.index.$u.test.isEmpty(d.captcha_code))return void e.index.showToast({title:r.t("captchaPlaceholder"),icon:"none"});const o=await l.send(d);o?(i.value=o,c.value=!1):!1===o&&p.refresh()};return(o,t)=>({a:e.t(e.unref(l).tips.value),b:e.unref(l).canGetCode.value?1:"",c:e.unref(l).canGetCode.value?"":1,d:e.o(m),e:e.sr(a,"22c56fea-0",{k:"smsRef"}),f:e.o(e.unref(l).codeChange),g:e.p({seconds:e.unref(l).seconds,"change-text":e.unref(l).changeText}),h:e.o((e=>d.captcha_code=e)),i:e.p({placeholder:e.unref(r.t)("captchaPlaceholder"),border:"surround",modelValue:d.captcha_code}),j:e.unref(p).image.value,k:e.o((o=>e.unref(p).refresh())),l:e.o((e=>c.value=!1)),m:e.o(f),n:e.p({show:c.value,title:e.unref(r.t)("captchaTitle"),"confirm-text":e.unref(r.t)("confirm"),"cancel-text":e.unref(r.t)("cancel"),"show-cancel-button":!0,confirmColor:"var(--primary-color)"})})}});tt.createComponent(s);
