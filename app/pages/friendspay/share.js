"use strict";const e=require("../../../common/vendor.js"),a=require("../../../locale/index.js"),t=require("../../../utils/common.js"),r=require("../../api/friendspay.js"),u=require("../../../hooks/useShare.js"),i=require("../../../stores/member.js"),l=require("../../../utils/topTabbar.js");if(require("../../../locale/i18n.js"),require("../../../locale/language.js"),require("../../../utils/pages.js"),require("../../../stores/system.js"),require("../../api/system.js"),require("../../../utils/request.js"),require("../../../stores/config.js"),require("../../api/auth.js"),require("../../stores/diy.js"),require("../../../hooks/useLogin.js"),require("../../api/diy.js"),require("../../api/member.js"),!Array){(e.resolveComponent("u-avatar")+e.resolveComponent("u--image")+e.resolveComponent("loading-page"))()}Math||((()=>"../../../node-modules/uview-plus/components/u-avatar/u-avatar.js")+(()=>"../../../node-modules/uview-plus/components/u--image/u--image.js")+s+o+(()=>"../../../components/loading-page/loading-page.js"))();const s=()=>"../../../components/share-poster/share-poster.js",o=()=>"./components/message.js",n=e.defineComponent({__name:"share",setup(s){const o=l.topTabar();o.setTopTabbarParam({title:""});const n=e.ref(!0),m=e.ref(!1),p=e.ref(0),v=e.ref(""),d=e.ref({}),f=e.ref(!0),_=e.ref(null),{setShare:g}=u.useShare(),c=i.useMemberStore(),y=e.computed((()=>c.info));e.onLoad((e=>{p.value=e.id||0,v.value=e.type||""})),e.onShow((()=>{p.value&&v.value&&b(v.value,p.value)})),e.onHide((()=>{_.value&&(clearTimeout(_.value),_.value=null)})),e.onUnload((()=>{_.value&&(clearTimeout(_.value),_.value=null)}));const b=(a,u)=>{f.value&&(n.value=!0,f.value=!1),r.getFriendspayInfo(a,u).then((t=>{d.value=t.data,n.value=!1,e.index.setNavigationBarTitle({title:d.value.config.pay_page_name}),o.setTopTabbarParam({title:d.value.config.pay_page_name});let r={desc:d.value.config.pay_leave_message,path:`/app/pages/friendspay/money?id=${d.value.trade_id}&type=${d.value.trade_type}`,link:""};if(d.value.member){let e=d.value.member.nickname;e=e.length>15?e=e.substring(0,15)+"...":e,r.title=`${e}希望你帮他付${d.value.money}元`}"[]"!==JSON.stringify(d.value.trade_info)&&d.value.trade_info.item_list.length,g({wechat:{...r},weapp:{...r}}),F(),e.nextTick$1((()=>{setTimeout((()=>{q.value&&(k.id=d.value.trade_id,k.type=d.value.trade_type,y.value&&y.value.member_id&&(k.member_id=y.value.member_id),q.value.loadPoster())}),400)})),2!=d.value.status&&1!=d.value.status&&-1!=d.value.status?_.value=setTimeout((()=>{b(a,u)}),3e3):(clearTimeout(_.value),_.value=null)})).catch((e=>{_.value&&(clearTimeout(_.value),_.value=null),n.value=!1;t.goback({title:"未找到帮付订单信息",url:"/app/pages/index/index",mode:"reLaunch"})}))},h=e.ref(null),j=()=>{h.value.open(d.value.config)},q=e.ref(null),x=e.ref("/app/pages/friendspay/money"),T=e.ref("");let k={};const F=()=>{T.value="?id="+d.value.trade_id,T.value+="&type="+d.value.trade_type},S=()=>{k.id=d.value.trade_id,k.type=d.value.trade_type,y.value&&y.value.member_id&&(k.member_id=y.value.member_id),q.value.openShare()};return(r,u)=>e.e({a:Object.keys(d.value).length&&!n.value},Object.keys(d.value).length&&!n.value?e.e({b:e.p({src:e.unref(t.img)(d.value.member.headimg),size:"50",leftIcon:"none","default-url":e.unref(t.img)("static/resource/images/default_headimg.png")}),c:e.t(d.value.member.nickname),d:"url("+e.unref(t.img)("static/resource/images/app/friendpay_bg.png")+") left bottom /100% no-repeat",e:e.t(e.unref(a.t)("payMoney")),f:e.t(parseFloat(d.value.money).toFixed(2).split(".")[0]),g:e.t(parseFloat(d.value.money).toFixed(2).split(".")[1]),h:2==d.value.status},2==d.value.status?{i:e.t(e.unref(a.t)("finish"))}:-1==d.value.status?{k:e.t(e.unref(a.t)("close"))}:{l:e.t(d.value.config.pay_type_name?d.value.config.pay_type_name:e.unref(a.t)("friendPay")),m:m.value,n:e.o(S)},{j:-1==d.value.status,o:2==d.value.status&&"[]"!==JSON.stringify(d.value.trade_info)&&d.value.trade_info.detail_url},2==d.value.status&&"[]"!==JSON.stringify(d.value.trade_info)&&d.value.trade_info.detail_url?{p:e.o((a=>e.unref(t.redirect)({url:d.value.trade_info.detail_url})))}:{},{q:e.t(e.unref(a.t)("friendPayOrderInfo")),r:d.value.config.pay_explain_switch},d.value.config.pay_explain_switch?{s:e.t(d.value.config.pay_explain_title),t:e.o(j)}:{},{v:"[]"!==JSON.stringify(d.value.trade_info)},"[]"!==JSON.stringify(d.value.trade_info)?e.e({w:d.value.trade_info.item_list.length},d.value.trade_info.item_list.length?{x:e.f(d.value.trade_info.item_list,((a,r,u)=>e.e({a:"46b38304-1-"+u,b:e.p({radius:"var(--goods-rounded-big)",width:"170rpx",height:"170rpx",src:e.unref(t.img)(a.item_image?a.item_image:""),model:"aspectFill"}),c:e.t(a.item_name),d:a.item_sub_name},a.item_sub_name?{e:e.t(a.item_sub_name)}:{},{f:e.t(parseFloat(a.item_price).toFixed(2).split(".")[0]),g:e.t(parseFloat(a.item_price).toFixed(2).split(".")[1]),h:e.t(a.item_num)}))),y:e.unref(t.img)("static/resource/images/diy/shop_default.jpg"),z:e.t(d.value.trade_info.item_total)}:{}):{A:e.t(d.value.body)},{B:e.sr(q,"46b38304-2",{k:"sharePosterRef"}),C:e.p({posterType:"friendspay",posterId:d.value.poster_id,posterParam:e.unref(k),copyUrl:x.value,copyUrlParam:T.value}),D:e.sr(h,"46b38304-3",{k:"messageRef"})}):{},{E:e.p({loading:n.value}),F:e.s(r.themeColor())})}});n.__runtimeHooks=1;const m=e._export_sfc(n,[["__scopeId","data-v-46b38304"]]);tt.createPage(m);
