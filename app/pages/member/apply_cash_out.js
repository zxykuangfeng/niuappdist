"use strict";const e=require("../../../common/vendor.js"),a=require("../../../locale/index.js"),t=require("../../../utils/common.js"),n=require("../../../stores/member.js"),r=require("../../api/member.js");if(require("../../../locale/i18n.js"),require("../../../locale/language.js"),require("../../../utils/pages.js"),require("../../../stores/system.js"),require("../../api/system.js"),require("../../../utils/request.js"),require("../../../stores/config.js"),require("../../api/auth.js"),require("../../stores/diy.js"),require("../../../hooks/useLogin.js"),!Array){e.resolveComponent("loading-page")()}Math;const o=e.defineComponent({__name:"apply_cash_out",setup(o){const c=e.ref(!0),u=e.ref(!1),i=n.useMemberStore(),s=e.reactive({apply_money:"",transfer_type:"",account_type:"money",account_id:0,transfer_payee:{open_id:"",channel:""}}),p=e.computed((()=>i.info?i.info[s.account_type]:0));e.watch((()=>s.transfer_type),(e=>{switch(e){case"bank":s.account_id=w.value?w.value.account_id:0;break;case"alipay":s.account_id=h.value?h.value.account_id:0;break;case"wechat_code":s.account_id=T.value?T.value.account_id:0;break;default:s.account_id=0}}),{immediate:!0});const l=e.reactive({is_auto_transfer:0,is_auto_verify:0,is_open:0,min:0,rate:0,transfer_type:[]});let d={},y="";e.onLoad((async a=>{d=a,y=e.index.getStorageSync("openid")||"",e.index.getStorageSync("cashOutAccountType")&&(s.account_type=e.index.getStorageSync("cashOutAccountType")),["money","commission"].includes(s.account_type)?await r.cashOutConfig().then((e=>{for(let a in t.deepClone(e.data))l[a]=t.deepClone(e.data[a]);l.transfer_type.includes("wechatpay")&&!y?l.transfer_type.splice(l.transfer_type.indexOf("wechatpay"),1):l.transfer_type.includes("wechatpay")&&A(),l.transfer_type.includes("bank")&&x(),l.transfer_type.includes("alipay")&&g(),l.transfer_type.includes("wechat_code")&&q(),s.transfer_type=l.transfer_type[0],d.type&&(s.transfer_type=d.type),c.value=!1})):e.index.showToast({title:"异常操作",icon:"none",success(){setTimeout((()=>{getCurrentPages().length>1?e.index.navigateBack({delta:1}):t.redirect({url:"/app/pages/member/index",mode:"reLaunch"})}),1500)}})})),e.onShow((()=>{t.getToken()&&i.getMemberInfo()}));const _=e.computed((()=>{let e=0;return s.apply_money&&Number(l.rate)&&(e=Number(s.apply_money)*Number(l.rate)/100),e.toFixed(2)})),m=()=>{parseFloat(p.value)&&(s.apply_money=t.moneyFormat(p.value))},f=()=>{s.apply_money=""},v=e.ref(!1),h=e.ref(null),g=()=>{const e={account_type:"alipay",account_id:0};let a=r.getFirstCashoutAccountInfo;d.type&&"alipay"==d.type&&d.account_id&&(a=r.getCashoutAccountInfo,e.account_id=d.account_id),v.value=!0,a(e).then((e=>{e.data&&e.data.account_id&&(h.value=e.data,"alipay"!=s.transfer_type||s.account_id||(s.account_id=h.value.account_id)),v.value=!1}))},b=e.ref(!1),w=e.ref(null),x=()=>{const e={account_type:"bank",account_id:0};let a=r.getFirstCashoutAccountInfo;d.type&&"bank"==d.type&&d.account_id&&(a=r.getCashoutAccountInfo,e.account_id=d.account_id),b.value=!0,a(e).then((e=>{e.data&&e.data.account_id&&(w.value=e.data,"bank"!=s.transfer_type||s.account_id||(s.account_id=w.value.account_id)),b.value=!1}))},k=e.ref(!1),T=e.ref(null),q=()=>{const e={account_type:"wechat_code",account_id:0};let a=r.getFirstCashoutAccountInfo;d.type&&"wechat_code"==d.type&&d.account_id&&(a=r.getCashoutAccountInfo,e.account_id=d.account_id),k.value=!0,a(e).then((e=>{e.data&&e.data.account_id&&(T.value=e.data,"wechat_code"!=s.transfer_type||s.account_id||(s.account_id=T.value.account_id)),k.value=!1}))},j=()=>{if(s.transfer_type?e.index.$u.test.isEmpty(s.apply_money)?(e.index.showToast({title:"请输入提现金额",icon:"none"}),0):e.index.$u.test.amount(s.apply_money)?parseFloat(s.apply_money)>parseFloat(p.value)?(e.index.showToast({title:"提现金额超出可提现金额",icon:"none"}),0):!(parseFloat(s.apply_money)<parseFloat(l.min)&&(e.index.showToast({title:"提现金额小于最低提现金额",icon:"none"}),1)):(e.index.showToast({title:"提现金额格式错误",icon:"none"}),0):(e.index.showToast({title:"没有可用的提现方式",icon:"none"}),0)){if(u.value)return;u.value=!0,r.cashOutApply(s).then((e=>{u.value=!1,i.getMemberInfo((()=>{t.redirect({url:"/app/pages/member/cash_out_detail",param:{id:e.data}})}))})).catch((()=>{u.value=!1}))}},C=()=>{if(!h.value)return e.index.showToast({title:"请先添加支付宝账号",icon:"none"}),!1;s.transfer_type="alipay"},F=()=>{if(!w.value)return e.index.showToast({title:"请先添加银行卡",icon:"none"}),!1;s.transfer_type="bank"},A=()=>{s.transfer_type="wechatpay"},I=()=>{if(!T.value)return e.index.showToast({title:"请先添加微信号",icon:"none"}),!1;s.transfer_type="wechat_code"};return(n,r)=>e.e({a:!c.value&&1==l.is_open},c.value||1!=l.is_open?{}:e.e({b:s.apply_money?"":"最小提现金额为"+e.unref(a.t)("currency")+e.unref(t.moneyFormat)(l.min),c:s.apply_money,d:e.o((e=>s.apply_money=e.detail.value)),e:Number(e.unref(_))},Number(e.unref(_))?{f:e.t(e.unref(_))}:{},{g:s.apply_money},s.apply_money?{h:e.o(f)}:{},{i:e.t(e.unref(a.t)("currency")),j:e.t(e.unref(t.moneyFormat)(e.unref(p))),k:e.t(l.rate+"%"),l:e.o(m),m:l.transfer_type.includes("wechatpay")&&e.unref(y)},l.transfer_type.includes("wechatpay")&&e.unref(y)?{n:e.unref(t.img)("static/resource/images/member/apply_withdrawal/wechat.png"),o:"wechatpay"==s.transfer_type?1:"",p:e.o(A)}:{},{q:l.transfer_type.includes("wechat_code")},l.transfer_type.includes("wechat_code")?e.e({r:e.unref(t.img)("static/resource/images/member/apply_withdrawal/wechat_code.png"),s:e.o(I),t:T.value},T.value?{v:e.t(T.value.account_no)}:{},{w:e.o(I),x:!T.value&&!k.value},T.value||k.value?{z:e.o((a=>e.unref(t.redirect)({url:"/app/pages/member/account",param:{type:"wechat_code",mode:"select"},mode:"redirectTo"})))}:{y:e.o((a=>e.unref(t.redirect)({url:"/app/pages/member/account",param:{type:"wechat_code",mode:"select"},mode:"redirectTo"})))},{A:"wechat_code"==s.transfer_type&&T.value?1:""}):{},{B:l.transfer_type.includes("alipay")},l.transfer_type.includes("alipay")?e.e({C:e.unref(t.img)("static/resource/images/member/apply_withdrawal/alipay-icon.png"),D:e.o(C),E:h.value},h.value?{F:e.t(h.value.account_no)}:{},{G:e.o(C),H:!h.value&&!v.value},h.value||v.value?{J:e.o((a=>e.unref(t.redirect)({url:"/app/pages/member/account",param:{type:"alipay",mode:"select"},mode:"redirectTo"})))}:{I:e.o((a=>e.unref(t.redirect)({url:"/app/pages/member/account",param:{type:"alipay",mode:"select"},mode:"redirectTo"})))},{K:"alipay"==s.transfer_type&&h.value?1:""}):{},{L:l.transfer_type.includes("bank")},l.transfer_type.includes("bank")?e.e({M:e.unref(t.img)("static/resource/images/member/apply_withdrawal/bank-icon.png"),N:e.o(F),O:w.value},w.value?{P:e.t(w.value.bank_name),Q:e.t(w.value.account_no.substring(w.value.account_no.length-4))}:{},{R:e.o(F),S:!w.value&&!b.value},w.value||b.value?{U:e.o((a=>e.unref(t.redirect)({url:"/app/pages/member/account",param:{type:"bank",mode:"select"},mode:"redirectTo"})))}:{T:e.o((a=>e.unref(t.redirect)({url:"/app/pages/member/account",param:{type:"bank",mode:"select"},mode:"redirectTo"})))},{V:"bank"==s.transfer_type&&w.value?1:""}):{},{W:""==s.apply_money||0==s.apply_money,X:u.value,Y:e.o(j),Z:e.o((a=>e.unref(t.redirect)({url:"/app/pages/member/cash_out"})))}),{aa:0==l.is_open&&!c.value},0!=l.is_open||c.value?{}:{ab:e.unref(t.img)("addon/shop/cart-empty.png")},{ac:e.p({loading:c.value}),ad:e.s(n.themeColor())})}}),c=e._export_sfc(o,[["__scopeId","data-v-1eb11bfb"]]);tt.createPage(c);
