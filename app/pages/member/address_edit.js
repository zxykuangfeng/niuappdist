"use strict";const e=require("../../../common/vendor.js"),a=require("../../../utils/common.js"),l=require("../../../locale/index.js"),r=require("../../api/member.js"),t=require("../../api/system.js");if(require("../../../utils/pages.js"),require("../../stores/diy.js"),require("../../../hooks/useLogin.js"),require("../../../utils/request.js"),require("../../../stores/member.js"),require("../../api/auth.js"),require("../../../stores/config.js"),require("../../../stores/system.js"),require("../../../locale/i18n.js"),require("../../../locale/language.js"),!Array){(e.resolveComponent("u-input")+e.resolveComponent("u-form-item")+e.resolveComponent("u-switch")+e.resolveComponent("u-form")+e.resolveComponent("area-select"))()}Math||((()=>"../../../node-modules/uview-plus/components/u-input/u-input.js")+(()=>"../../../node-modules/uview-plus/components/u-form-item/u-form-item.js")+(()=>"../../../node-modules/uview-plus/components/u-switch/u-switch.js")+(()=>"../../../node-modules/uview-plus/components/u-form/u-form.js")+(()=>"../../../components/area-select/area-select.js"))();const d=e.defineComponent({__name:"address_edit",setup(d){const s=e.ref({id:0,name:"",mobile:"",province_id:0,city_id:0,district_id:0,lat:"",lng:"",address:"",address_name:"",full_address:"",is_default:0,area:""}),i=e.ref(),o=e.ref(null),u=e.ref(""),n=e.ref(!1),c=e.ref(!1),v=e.ref("address"),m=e.ref(2),p=e.ref(null);e.onLoad((a=>{m.value=a.isSelectMap||"";const l=e.index.getStorageSync("selectAddressCallback");if(a.id)r.getAddressInfo(a.id).then((e=>{e.data&&Object.assign(s.value,e.data),l&&(v.value="express"==l.delivery?"address":"locationAddress")}));else if(a.name){e.index.getStorageSync("addressInfo")&&Object.assign(s.value,e.index.getStorageSync("addressInfo")),s.value.address=a.name,x(a.latng);var t=j("latng").split(",");s.value.lat=t[0],s.value.lng=t[1]}u.value=a.source||"",l&&(v.value="express"==l.delivery?"address":"locationAddress"),e.nextTick$1((()=>{p.value&&p.value.proactive()}))}));const f=e.computed((()=>({name:{type:"string",required:!0,message:l.t("namePlaceholder"),trigger:["blur","change"]},mobile:[{type:"string",required:!0,message:l.t("mobilePlaceholder"),trigger:["blur","change"]},{validator(e,a,r){/^1[3-9]\d{9}$/.test(a)?r():r(new Error(l.t("mobileError")))}}],area:{validator(){let a=!0;return e.index.$u.test.isEmpty(s.value.area)&&e.index.$u.test.isEmpty(s.value.address_name)&&(a=!1),a},message:l.t("selectAreaPlaceholder")},address:{type:"string",required:!0,message:l.t("addressPlaceholder"),trigger:["blur","change"]}}))),g=()=>{c.value=!0,i.value.open()},h=e=>{var a,l,r,t,d,i,o,u,n;!c.value||s.value.province_id!=(null==(a=e.province)?void 0:a.id)&&s.value.city_id==(null==(l=e.city)?void 0:l.id)&&s.value.district_id==(null==(r=e.district)?void 0:r.id)||(s.value.lat="",s.value.lng=""),s.value.province_id=(null==(t=e.province)?void 0:t.id)||0,s.value.city_id=(null==(d=e.city)?void 0:d.id)||0,s.value.district_id=(null==(i=e.district)?void 0:i.id)||0,s.value.area=`${(null==(o=e.province)?void 0:o.name)||""}${(null==(u=e.city)?void 0:u.name)||""}${(null==(n=e.district)?void 0:n.name)||""}`,c.value=!1},_=e.ref(!1),b=()=>{const l=s.value.id?r.editAddress:r.addAddress;o.value.validate().then((()=>{if(!_.value){if(_.value=!0,n.value=!0,s.value.full_address=s.value.area+s.value.address,1==m.value&&!s.value.lat&&!s.value.lng)return e.index.showToast({title:"缺少经纬度，请在地图上重新选点",icon:"none"}),_.value=!1,n.value=!1,!1;l(s.value).then((l=>{_.value=!1,setTimeout((()=>{if(n.value=!1,"shop_order_payment"==u.value){const r=e.index.getStorageSync("selectAddressCallback");r&&(r.address_id=l.data.id||s.value.id,e.index.setStorage({key:"selectAddressCallback",data:r,success(){a.redirect({url:r.back,mode:"redirectTo"})}}))}else a.redirect({url:"/app/pages/member/address",mode:"redirectTo",param:{source:u.value}})}),1e3)})).catch((()=>{_.value=!1,n.value=!1}))}}))},y=()=>{e.index.chooseLocation({success:e=>{if(e.latitude&&(s.value.lat=e.latitude),e.longitude&&(s.value.lng=e.longitude),e.address&&(s.value.area=e.address),e.name&&(s.value.address_name=e.address),e.name&&(s.value.address=e.name),e.latitude&&e.longitude){let a=e.latitude+","+e.longitude;x(a)}},fail:a=>{if(a.errMsg&&a.errno)if(104==a.errno){let a="用户未授权隐私权限，选择位置失败";e.index.showToast({title:a,icon:"none"})}else if(112==a.errno){let a="隐私协议中未声明，打开地图选择位置失败";e.index.showToast({title:a,icon:"none"})}else e.index.showToast({title:a.errMsg,icon:"none"})}})},x=a=>{t.getAddressByLatlng({latlng:a}).then((a=>{a.data?(s.value.full_address="",s.value.full_address+=null!=a.data.province?a.data.province:"",s.value.full_address+=null!=a.data.city?""+a.data.city:"",s.value.full_address+=null!=a.data.district?""+a.data.district:"",s.value.address_name=s.value.full_address.replace(/-/g,""),s.value.area=a.data.province+a.data.city+a.data.district||a.data.full_address,s.value.province_id=null!=a.data.province_id?a.data.province_id:0,s.value.city_id=null!=a.data.city_id?a.data.city_id:0,s.value.district_id=null!=a.data.district_id?a.data.district_id:0):e.index.showToast({title:a.msg,icon:"none"})}))},j=e=>{for(var a=window.location.search.substring(1).split("&"),l=0;l<a.length;l++){var r=a[l].split("=");if(r[0]==e)return r[1]}return!1};return(a,r)=>e.e({a:e.o(e.m((e=>s.value.name=e),{trim:!0},!0)),b:e.p({fontSize:"28rpx",border:"none",clearable:!0,maxlength:"25",placeholderStyle:"color: #888",placeholder:e.unref(l.t)("namePlaceholder"),modelValue:s.value.name}),c:e.p({label:e.unref(l.t)("name"),prop:"name",labelWidth:"200rpx"}),d:e.o(e.m((e=>s.value.mobile=e),{trim:!0},!0)),e:e.p({fontSize:"28rpx",maxlength:"11",border:"none",clearable:!0,placeholder:e.unref(l.t)("mobilePlaceholder"),placeholderStyle:"color: #888",modelValue:s.value.mobile}),f:e.p({label:e.unref(l.t)("mobile"),prop:"mobile",labelWidth:"200rpx"}),g:"address"==v.value&&1!=m.value},"address"==v.value&&1!=m.value?e.e({h:!s.value.area},s.value.area?{j:e.t(s.value.area)}:{i:e.t(e.unref(l.t)("selectAreaPlaceholder"))},{k:e.o(y),l:e.o(g)}):e.e({m:s.value.area||s.value.address_name},s.value.area||s.value.address_name?{n:e.t(s.value.area||s.value.address_name)}:{o:e.t(e.unref(l.t)("selectAddressPlaceholder"))},{p:e.o(y)}),{q:e.p({label:e.unref(l.t)("selectArea"),prop:"area",labelWidth:"200rpx"}),r:e.o((e=>s.value.address=e)),s:e.p({fontSize:"28rpx",border:"none",clearable:!0,maxlength:"120",placeholder:e.unref(l.t)("addressPlaceholder"),placeholderStyle:"color: #888",modelValue:s.value.address}),t:e.p({label:e.unref(l.t)("address"),prop:"address",labelWidth:"200rpx"}),v:e.o((e=>s.value.is_default=e)),w:e.p({size:"20",activeValue:1,inactiveValue:0,activeColor:"var(--primary-color)",inactiveColor:"var(--temp-bg)",modelValue:s.value.is_default}),x:e.p({label:e.unref(l.t)("defaultAddress"),prop:"name","border-bottom":!1,labelWidth:"200rpx"}),y:e.sr(o,"86c87a63-0",{k:"formRef"}),z:e.p({labelPosition:"left",model:s.value,errorType:"toast",rules:e.unref(f)}),A:e.t(e.unref(l.t)("save")),B:e.o(b),C:n.value,D:_.value,E:n.value?1:"",F:e.sr(i,"86c87a63-10",{k:"areaRef"}),G:e.o(h),H:e.p({"area-id":s.value.district_id||s.value.city_id}),I:e.s(a.themeColor())})}}),s=e._export_sfc(d,[["__scopeId","data-v-86c87a63"]]);tt.createPage(s);
