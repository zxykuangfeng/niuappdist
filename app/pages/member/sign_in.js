"use strict";const e=require("../../../common/vendor.js"),t=require("../../../utils/common.js"),a=require("../../api/member.js"),u=require("../../../stores/member.js"),r=require("../../../utils/topTabbar.js");if(require("../../../utils/pages.js"),require("../../stores/diy.js"),require("../../../hooks/useLogin.js"),require("../../../utils/request.js"),require("../../../locale/index.js"),require("../../../locale/i18n.js"),require("../../../locale/language.js"),require("../../../stores/system.js"),require("../../api/system.js"),require("../../../stores/config.js"),require("../../api/auth.js"),!Array){(e.resolveComponent("u-empty")+e.resolveComponent("u-popup")+e.resolveComponent("loading-page"))()}Math||((()=>"../../../node-modules/uview-plus/components/u-empty/u-empty.js")+(()=>"../../../node-modules/uview-plus/components/u-popup/u-popup.js")+(()=>"../../../components/loading-page/loading-page.js"))();const n=e.defineComponent({__name:"sign_in",setup(n){const o=e.reactive({dataCount:[],weekCount:[],curYear:0,curMonth:0,curDate:0,curWeek:0,signInList:[],packList:[]}),s=e.reactive({weekDay:0,week:0}),i=e.ref(!1),c=e.ref(!1),l=e.ref({}),g=e.ref(!1),p=e.ref({}),v=e.ref(!1),m=e.ref(!1),h=e.ref({}),f=e.ref(!1);let d=null,M=null;e.onLoad((()=>{let t=new Date;o.curYear=t.getFullYear(),o.curMonth=t.getMonth(),o.curDate=t.getDate(),o.curWeek=t.getDay(),0==o.curWeek&&(o.curWeek=7),d=e.toRaw(o.curYear),M=e.toRaw(o.curMonth),D(),j(),w({year:o.curYear,month:o.curMonth+1}),b()}));const b=()=>{i.value=!0,a.getSignConfig().then((e=>{l.value=e.data,l.value.is_use||(S=N.setTopTabbarParam({title:"我的签到",topStatusBar:{textColor:"#303133",bgColor:"#fff"}})),i.value=!1}))},w=e=>{a.getSignInfo(e).then((e=>{o.signInList=[],o.packList=[],o.packList=e.data.period,e.data.length&&(o.signInList=e.data.days.map((e=>Number(e)))),f.value=!0}))},D=()=>{let e=new Date(o.curYear,o.curMonth+1,0).getDate(),t=new Date(o.curYear,o.curMonth,1).getDay();o.dataCount=[];for(let a=1;a<e+t;a++){let e=a-t+1;o.dataCount.push(e)}},j=()=>{let e=`${o.curYear}-${o.curMonth+1>9?o.curMonth+1:"0"+(o.curMonth+1)}-${o.curDate>9?o.curDate:"0"+o.curDate}`;for(let t=o.curWeek-1;t>=0;t--){const a=new Date(e).getDate()-t;o.weekCount.push(a)}for(let t=1;t<=7-o.curWeek;t++){const a=new Date(e).getDate()+t;o.weekCount.push(a)}},y=()=>{let e=(new Date).getMonth();o.curMonth==e||(o.curMonth=(new Date).getMonth(),o.curYear=(new Date).getFullYear(),w({year:o.curYear,month:o.curMonth+1})),c.value=!c.value},k=e=>{o.dataCount=[],"prev"==e?(o.curMonth--,o.curMonth<0&&(o.curMonth=11,o.curYear--),s.weekDay=1,f.value=!1):(o.curMonth++,o.curMonth>11&&(o.curMonth=0,o.curYear++),s.weekDay=1,f.value=!1);let t={year:o.curYear,month:o.curMonth+1};w(t),D()},_=u.useMemberStore(),Y=()=>{a.setSign().then((e=>{if(Object.values(e.data).length){p.value=e.data;let t=0;Object.values(p.value.awards).forEach(((e,a)=>{e.content||t++})),t==Object.values(p.value.awards).length&&(p.value.info=""),w({year:o.curYear,month:o.curMonth+1}),b(),_.getMemberInfo(),v.value=!0}}))},C=e.ref(null),q=t=>{let{curYear:u,curMonth:r}=e.toRefs(o),n=`${u.value}-${r.value+1<10?"0"+(r.value+1):r.value+1}-${t<10?"0"+t:t}`;if(!o.packList.some((e=>e.day==n)))return;C.value=t;let s={year:o.curYear,month:o.curMonth+1,day:t};a.getDayPack(s).then((e=>{"[]"!=JSON.stringify(e.data)&&(h.value=e.data,m.value=!0)}))},x=e=>o.signInList.includes(e),O=e=>e>0&&e<=o.dataCount.length&&(e==o.curDate&&d==o.curYear&&M==o.curMonth||void 0),L=t=>{let{curYear:a,curMonth:u}=e.toRefs(o),r=`${a.value}-${u.value+1<10?"0"+(u.value+1):u.value+1}-${t<10?"0"+t:t}`;return o.packList.some((e=>e.day==r&&e.award))},$=e=>e>0?e:"";let I={};I=e.index.getMenuButtonBoundingClientRect();const N=r.topTabar();let S=N.setTopTabbarParam({title:"我的签到"});return e.computed((()=>t.pxToRpx(Number(I.height)+I.top+8)+382+"rpx;")),e.computed((()=>t.pxToRpx(Number(I.height)+I.top+8)+50+"rpx;")),(a,u)=>e.e({a:Object.values(l.value).length},Object.values(l.value).length?e.e({b:l.value.is_use},l.value.is_use?e.e({c:c.value},c.value?{d:e.o((e=>k("prev"))),e:e.t(o.curYear),f:e.t(o.curMonth+1),g:e.o((e=>k("next"))),h:e.o(y)}:e.e({i:e.t(l.value.days),j:!c.value},c.value?{}:{k:e.o((e=>c.value=!c.value))}),{l:!c.value},c.value?{n:e.f(o.dataCount,((a,u,r)=>e.e({a:$(a)},$(a)?e.e({b:e.t($(a)),c:$(a)},$(a)?e.e({d:L(a)},L(a)?{e:e.unref(t.img)("static/resource/images/app/package.png")}:x(a)&&f.value?{g:e.unref(t.img)("static/resource/images/app/hassigin.png")}:e.e({h:!x(a)&&a<o.curDate&&o.curMonth+1==(new Date).getMonth()+1},!x(a)&&a<o.curDate&&o.curMonth+1==(new Date).getMonth()+1?{i:e.unref(t.img)("static/resource/images/app/nosigin.png")}:{j:e.unref(t.img)("static/resource/images/app/nosigin1.png")}),{f:x(a)&&f.value}):{},{k:x(a)&&f.value?1:"",l:!x(a)&&a<o.curDate&&o.curMonth+1==(new Date).getMonth()+1&&o.curYear==(new Date).getFullYear()?1:"",m:O(a)?1:"",n:O(a)?"":1,o:e.o((e=>q(a)))}):{},{p:O(a)},(O(a),{}))))}:{m:e.f(o.weekCount,((a,u,r)=>e.e({a:$(a)},$(a)?e.e({b:e.t($(a)),c:$(a)},$(a)?e.e({d:L(a)},L(a)?{e:e.unref(t.img)("static/resource/images/app/package.png")}:x(a)?{g:e.unref(t.img)("static/resource/images/app/hassigin.png")}:e.e({h:!x(a)&&a<o.curDate&&o.curMonth+1==(new Date).getMonth()+1},!x(a)&&a<o.curDate&&o.curMonth+1==(new Date).getMonth()+1?{i:e.unref(t.img)("static/resource/images/app/nosigin.png")}:{j:e.unref(t.img)("static/resource/images/app/nosigin1.png")}),{f:x(a)}):{},{k:x(a)?1:"",l:!x(a)&&a<o.curDate&&o.curMonth+1==(new Date).getMonth()+1?1:"",m:O(a)?1:"",n:O(a)?"":1,o:e.o((e=>q(a)))}):{},{p:O(a)},(O(a),{}),{q:u})))},{o:o.curMonth+1==(new Date).getMonth()+1&&o.curYear==(new Date).getFullYear()},o.curMonth+1==(new Date).getMonth()+1&&o.curYear==(new Date).getFullYear()?e.e({p:!l.value.is_sign},l.value.is_sign?{s:`url(${e.unref(t.img)("static/resource/images/app/button_bg1.png")})`}:{q:`url(${e.unref(t.img)("static/resource/images/app/button_bg2.png")})`,r:e.o(Y)}):{},{t:l.value&&l.value.continue_award&&Object.keys(l.value.continue_award).length},l.value&&l.value.continue_award&&Object.keys(l.value.continue_award).length?{v:e.f(l.value.continue_award,((a,u,r)=>e.e({a:(u+1)%4==1},(u+1)%4==1?{b:e.unref(t.img)("static/resource/images/app/icon_02.png")}:(u+1)%4==2?{d:e.unref(t.img)("static/resource/images/app/icon_03.png")}:(u+1)%4==3?{f:e.unref(t.img)("static/resource/images/app/icon_04.png")}:(u+1)%4==0?{h:e.unref(t.img)("static/resource/images/app/icon_05.png")}:{},{c:(u+1)%4==2,e:(u+1)%4==3,g:(u+1)%4==0,i:e.t(a.continue_sign),j:a.gift&&a.gift.total},a.gift&&a.gift.total?{k:e.unref(t.img)(a.gift.total.icon),l:e.t(a.gift.total.text)}:{},{m:Number(l.value.days)<Number(a.continue_sign)},(Number(l.value.days),Number(a.continue_sign),{}),{n:u,o:u?1:""})))}:{}):{w:e.p({text:"签到未开启",width:"347rpx",height:"265rpx",icon:e.unref(t.img)("static/resource/images/system/empty.png")})},{x:e.f(l.value.rule_explain.split("\n"),((t,a,u)=>({a:e.t(t)}))),y:e.o((e=>g.value=!1)),z:e.o((e=>g.value=!1)),A:e.p({show:g.value,round:16,mode:"bottom"}),B:Object.values(p.value).length},Object.values(p.value).length?e.e({C:e.unref(t.img)("static/resource/images/app/award.png"),D:e.t(p.value.title),E:p.value.info},p.value.info?{F:e.t(p.value.info)}:{},{G:e.f(p.value.awards,((a,u,r)=>e.e({a:a.content},a.content?{b:e.f(a.content,((a,u,r)=>({a:e.unref(t.img)(a.icon),b:e.t(a.text)})))}:{}))),H:e.o((e=>v.value=!1)),I:e.o((e=>v.value=!1))}):{},{J:e.o((e=>v.value=!1)),K:e.p({show:v.value,customStyle:{backgroundColor:"transparent"},mode:"center",round:"var(--rounded-big)",safeAreaInsetBottom:!1}),L:Object.values(h.value).length},Object.values(h.value).length?{M:e.unref(t.img)("static/resource/images/app/award.png"),N:e.t(h.value.title),O:e.t(h.value.info),P:e.f(h.value.awards,((a,u,r)=>e.e({a:a.content},a.content?{b:e.f(a.content,((a,u,r)=>({a:e.unref(t.img)(a.icon),b:e.t(a.text),c:u})))}:{}))),Q:e.o((e=>m.value=!1)),R:e.o((e=>m.value=!1))}:{},{S:e.o((e=>m.value=!1)),T:e.p({show:m.value,customStyle:{backgroundColor:"transparent"},mode:"center",round:"var(--rounded-big)",safeAreaInsetBottom:!1}),U:l.value&&l.value.is_use?1:""}):{},{V:e.p({loading:i.value}),W:e.s(a.themeColor())})}}),o=e._export_sfc(n,[["__scopeId","data-v-3048b477"]]);tt.createPage(o);
