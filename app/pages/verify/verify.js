"use strict";const e=require("../../../common/vendor.js"),r=require("../../../utils/common.js"),a=require("../../api/verify.js");if(require("../../../locale/i18n.js"),require("../../../stores/system.js"),require("../../../utils/pages.js"),require("../../stores/diy.js"),require("../../../hooks/useLogin.js"),require("../../../utils/request.js"),require("../../../stores/member.js"),require("../../api/member.js"),require("../../api/auth.js"),require("../../../stores/config.js"),require("../../../locale/index.js"),require("../../../locale/language.js"),require("../../api/system.js"),!Array){e.resolveComponent("loading-page")()}Math;const t=e.defineComponent({__name:"verify",setup(t){const i=e.ref(!0),u=e.ref("");e.onLoad((e=>{if(e.code&&(u.value=e.code),e.scene){let r=decodeURIComponent(e.scene).split("&");r.length&&r.forEach((e=>{-1!=e.indexOf("code")&&(u.value=e.split("-")[1])}))}})),e.onShow((()=>{r.getToken()&&(s(),o())}));const s=()=>{a.getCheckVerifier().then((a=>{a.data?i.value=!1:(e.index.showToast({title:"非核销员无此权限",icon:"none"}),setTimeout((()=>{getCurrentPages().length>1?e.index.navigateBack({delta:1}):r.redirect({url:"/app/pages/member/index",mode:"reLaunch"})}),1e3))}))},n=e.ref({}),o=()=>{i.value=!0,a.getVerifierInfo({code:u.value}).then((e=>{n.value=e.data,i.value=!1})).catch((()=>{setTimeout((()=>{i.value=!1,r.redirect({url:"/app/pages/verify/index",param:{},mode:"redirectTo"})}),1e3)}))};let l=!1;const c=()=>{if(n.value.is_can_use){if(l)return!1;l=!0,a.verify(u.value).then((a=>{e.index.showToast({title:"核销成功",icon:"none"}),setTimeout((()=>{l=!1,r.redirect({url:"/app/pages/verify/index",param:{},mode:"redirectTo"})}),1e3)})).catch((()=>{l=!1}))}};return(a,t)=>e.e({a:!i.value&&n.value&&n.value.value},!i.value&&n.value&&n.value.value?{b:e.o((a=>e.unref(r.redirect)({url:"/app/pages/verify/record"}))),c:e.unref(r.img)("static/resource/images/verify/yanzhenghexiaoma.png"),d:e.unref(r.img)("static/resource/images/verify/youjiantou.png"),e:e.unref(r.img)("static/resource/images/verify/hexiao.png"),f:e.f(n.value.value.list,((a,t,i)=>e.e({a:a.cover},a.cover?{b:e.unref(r.img)(a.cover)}:{c:e.unref(r.img)("addon/tourism/tourism/member/hotel.png")},{d:e.t(a.name),e:a.sub_name},a.sub_name?{f:e.t(a.sub_name)}:{},{g:e.t(a.verify_num),h:e.t(a.un_use_msg),i:n.value.value.list.length-1!=t?1:"",j:t}))),g:e.t(n.value.type_name),h:e.f(n.value.value.content.fixed,((r,a,t)=>({a:e.t(r.title),b:e.t(r.value)}))),i:e.f(n.value.value.content.diy,((r,a,t)=>({a:e.t(r.title),b:e.f(r.list,((r,a,t)=>({a:e.t(r.title),b:e.t(r.value),c:a}))),c:a}))),j:e.n(n.value.is_can_use?"primary-btn-bg":"bg-[#ccc]"),k:e.o(c)}:{},{l:e.p({loading:i.value}),m:e.s(a.themeColor())})}}),i=e._export_sfc(t,[["__scopeId","data-v-0cbbe88d"]]);tt.createPage(i);
