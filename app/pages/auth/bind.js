"use strict";const e=require("../../../common/vendor.js"),o=require("../../../locale/index.js"),r=require("../../api/auth.js"),t=require("../../api/member.js"),n=require("../../../stores/member.js"),i=require("../../../stores/config.js"),l=require("../../../hooks/useLogin.js"),u=require("../../../utils/common.js"),s=require("../../../utils/topTabbar.js");if(require("../../../locale/i18n.js"),require("../../../locale/language.js"),require("../../../utils/pages.js"),require("../../../stores/system.js"),require("../../api/system.js"),require("../../../utils/request.js"),require("../../stores/diy.js"),!Array){(e.resolveComponent("u-input")+e.resolveComponent("u-form-item")+e.resolveComponent("sms-code")+e.resolveComponent("u-form")+e.resolveComponent("u-checkbox")+e.resolveComponent("u-checkbox-group"))()}Math||((()=>"../../../node-modules/uview-plus/components/u-input/u-input.js")+(()=>"../../../node-modules/uview-plus/components/u-form-item/u-form-item.js")+(()=>"../../../components/sms-code/sms-code.js")+(()=>"../../../node-modules/uview-plus/components/u-form/u-form.js")+(()=>"../../../node-modules/uview-plus/components/u-checkbox/u-checkbox.js")+(()=>"../../../node-modules/uview-plus/components/u-checkbox-group/u-checkbox-group.js"))();const a=e.defineComponent({__name:"bind",setup(a){let p={};p=e.index.getMenuButtonBoundingClientRect();s.topTabar().setTopTabbarParam({title:"",topStatusBar:{bgColor:"#fff",textColor:"#333"}}),e.computed((()=>Object.keys(p).length?u.pxToRpx(Number(p.height))+u.pxToRpx(p.top)+u.pxToRpx(8)+"rpx":"auto"));const m=n.useMemberStore(),d=e.computed((()=>m.info)),c=e.computed((()=>i.useConfigStore().login)),b=e.ref(!1),g=e.ref(!1),f=e.reactive({mobile:"",mobile_code:"",mobile_key:""}),h=e.ref(!0),v=e.ref(null);e.onLoad((()=>{setTimeout((()=>{h.value=!1}),800),e.nextTick$1((()=>{v.value&&v.value.proactive()})),e.index.getStorageSync("openid")&&Object.assign(f,{openid:e.index.getStorageSync("openid")}),e.index.getStorageSync("pid")&&Object.assign(f,{pid:e.index.getStorageSync("pid")}),e.index.getStorageSync("unionid")&&Object.assign(f,{unionid:e.index.getStorageSync("unionid")})}));const x={mobile:[{type:"string",required:!0,message:o.t("mobilePlaceholder"),trigger:["blur","change"]},{validator(e,o,r){/^1[3-9]\d{9}$/.test(o)?r():r(new Error("请输入正确的手机号"))},message:o.t("mobileError"),trigger:["change","blur"]}],mobile_code:{type:"string",required:!0,message:o.t("codePlaceholder"),trigger:["blur","change"]}},j=()=>{g.value=!g.value},y=e.ref(null),k=()=>{y.value.validate().then((()=>{if(b.value)return;b.value=!0;(d.value?t.bindMobile:r.bind)(f).then((e=>{d.value?(m.getMemberInfo(),u.redirect({url:"/app/pages/member/personal",mode:"redirectTo"})):(m.setToken(e.data.token),l.useLogin().handleLoginBack())})).catch((()=>{b.value=!1}))}))};return(r,t)=>e.e({a:e.t(e.unref(o.t)("bindMobile")),b:e.t(e.unref(o.t)("bindMobileTip")),c:e.o((e=>f.mobile=e)),d:e.p({type:"number",maxlength:"11",border:"none",placeholder:e.unref(o.t)("mobilePlaceholder"),disabled:h.value,fontSize:"26rpx",placeholderClass:"!text-[var(--text-color-light9)] text-[26rpx]",modelValue:f.mobile}),e:e.p({label:"",prop:"mobile","border-bottom":!1}),f:e.o((e=>f.mobile_key=e)),g:e.p({mobile:f.mobile,type:"bind_mobile",modelValue:f.mobile_key}),h:e.o((e=>f.mobile_code=e)),i:e.p({type:"number",maxlength:"4",border:"none",placeholder:e.unref(o.t)("codePlaceholder"),disabled:h.value,fontSize:"26rpx",placeholderClass:"!text-[var(--text-color-light9)]",modelValue:f.mobile_code}),j:e.p({label:"",prop:"mobile_code","border-bottom":!1}),k:e.sr(y,"d531a787-0",{k:"formRef"}),l:e.p({labelPosition:"left",model:f,errorType:"toast",rules:x}),m:e.unref(c).agreement_show},e.unref(c).agreement_show?{n:e.p({activeColor:"var(--primary-color)",checked:g.value,shape:"circle",size:"24rpx",customStyle:{marginTop:"4rpx"}}),o:e.o(j),p:e.t(e.unref(o.t)("agreeTips")),q:e.t(e.unref(o.t)("privacyAgreement")),r:e.o((o=>e.unref(u.redirect)({url:"/app/pages/auth/agreement?key=privacy"}))),s:e.t(e.unref(o.t)("and")),t:e.t(e.unref(o.t)("userAgreement")),v:e.o((o=>e.unref(u.redirect)({url:"/app/pages/auth/agreement?key=service"}))),w:e.o(j)}:{},{x:e.t(e.unref(o.t)("bind")),y:e.o(k),z:e.s(r.themeColor())})}}),p=e._export_sfc(a,[["__scopeId","data-v-d531a787"]]);tt.createPage(p);
