"use strict";const e=require("../../../common/vendor.js"),r=require("../../../utils/common.js"),o=require("../../../locale/index.js"),n=require("../../../hooks/useLogin.js"),t=require("../../../stores/config.js"),u=require("../../../stores/member.js"),i=require("../../../utils/topTabbar.js"),s=require("../../../stores/system.js");if(require("../../../utils/pages.js"),require("../../stores/diy.js"),require("../../../locale/i18n.js"),require("../../../locale/language.js"),require("../../../utils/request.js"),require("../../api/auth.js"),require("../../api/member.js"),require("../../api/system.js"),!Array){(e.resolveComponent("u-checkbox")+e.resolveComponent("u-checkbox-group")+e.resolveComponent("uni-popup")+e.resolveComponent("bind-mobile"))()}Math||((()=>"../../../node-modules/uview-plus/components/u-checkbox/u-checkbox.js")+(()=>"../../../node-modules/uview-plus/components/u-checkbox-group/u-checkbox-group.js")+(()=>"../../../uni_modules/uni-popup/components/uni-popup/uni-popup.js")+(()=>"../../../components/bind-mobile/bind-mobile.js"))();const a=e.defineComponent({__name:"index",setup(a){let l={};l=e.index.getMenuButtonBoundingClientRect();i.topTabar().setTopTabbarParam({title:"",topStatusBar:{textColor:"#333"}}),e.computed((()=>Object.keys(l).length?r.pxToRpx(Number(l.height))+r.pxToRpx(l.top)+r.pxToRpx(8)+"rpx":"auto"));const p=e.ref(""),c=e.ref(!1),g=t.useConfigStore(),m=e.computed((()=>g.login)),f=n.useLogin();u.useMemberStore(),e.computed((()=>u.useMemberStore().info));const d=s.useSystemStore();e.computed((()=>!c.value&&g.login.agreement_show?"":"getPhoneNumber"));const _=e.ref(null),b=e.computed((()=>!g.login.is_auth_register)),v=e.ref(!1),h=e.ref(!1),x=e.ref(),k=()=>{x.value.close()},y=()=>{c.value=!0,x.value.close(),S()},j=e.ref(null);e.onLoad((async()=>{await d.getSiteInfoFn(),await g.getLoginConfig();let o=!g.login.is_username&&!g.login.is_mobile&&!g.login.is_bind_mobile;if(!r.getToken()&&o&&b.value)return e.index.showToast({title:"商家未开启登录注册",icon:"none"}),void setTimeout((()=>{r.redirect({url:"/app/pages/index/index",mode:"reLaunch"})}),100);p.value=e.index.getStorageSync("wap_member_mobile"),p.value||(p.value=e.index.getStorageSync("wap_member_not_control_mobile")),e.nextTick$1((()=>{_.value&&_.value.proactive()}))})),e.onShow((()=>{v.value=!1}));const q=e.computed((()=>{var e="";return g.login.bg_url&&(e+="background-image:url("+r.img(g.login.bg_url)+");",e+="background-size: 100%;",e+="background-position: top;",e+="background-repeat: no-repeat;"),e})),S=(r=null,n=null)=>{((r="")=>!(c.value||!g.login.agreement_show||(r?e.index.showToast({title:o.t("isAgreeTips"),icon:"none"}):x.value.open(),0)))()||v.value||(v.value=!0,r||(r=()=>{v.value=!1}),w(r,n))},w=(r,o)=>{let n=e.index.getStorageSync("login_config"),t=e.index.getStorageSync("member_exist");n.is_auth_register&&n.is_force_access_user_info&&!t?(h.value.show=!0,v.value=!1):(o=o||{},f.getAuthCode({backFlag:!0,successCallback:r,...o}))},T=()=>{c.value=!c.value};return(n,t)=>{var u,i,s,a,l,p;return e.e({a:null==(u=e.unref(d).site)?void 0:u.front_end_logo},(null==(i=e.unref(d).site)?void 0:i.front_end_logo)?{b:e.unref(r.img)(null==(s=e.unref(d).site)?void 0:s.front_end_logo)}:(null==(a=e.unref(d).site)?void 0:a.front_end_icon)?{d:e.unref(r.img)(null==(l=e.unref(d).site)?void 0:l.front_end_icon)}:{},{c:null==(p=e.unref(d).site)?void 0:p.front_end_icon,e:e.t(e.unref(m).desc),f:e.unref(m).is_mobile},e.unref(m).is_mobile?{}:!e.unref(m).is_mobile&&e.unref(m).is_username?{h:e.t(e.unref(o.t)("accountLogin")),i:e.o((o=>e.unref(r.redirect)({url:"/app/pages/auth/login",param:{type:"username"}})))}:{},{g:!e.unref(m).is_mobile&&e.unref(m).is_username,j:e.unref(m).agreement_show},e.unref(m).agreement_show?{k:e.p({activeColor:"var(--primary-color)",checked:c.value,shape:"circle",size:"30rpx"}),l:e.o(T),m:e.t(e.unref(o.t)("agreeTips")),n:e.t(e.unref(o.t)("privacyAgreement")),o:e.o((o=>e.unref(r.redirect)({url:"/app/pages/auth/agreement?key=privacy"}))),p:e.t(e.unref(o.t)("and")),q:e.t(e.unref(o.t)("userAgreement")),r:e.o((o=>e.unref(r.redirect)({url:"/app/pages/auth/agreement?key=service"}))),s:e.o(T)}:{},{t:e.unref(m).is_mobile&&e.unref(m).is_username},e.unref(m).is_mobile&&e.unref(m).is_username?{v:e.t(e.unref(o.t)("otherLogin")),w:e.o((o=>e.unref(r.redirect)({url:"/app/pages/auth/login",param:{type:"username"}}))),x:e.t(e.unref(o.t)("accountLogin"))}:{},{y:e.s(e.unref(q)),z:e.t(e.unref(o.t)("agreeTips")),A:e.t(e.unref(o.t)("privacyAgreement")),B:e.o((o=>e.unref(r.redirect)({url:"/app/pages/auth/agreement?key=privacy"}))),C:e.t(e.unref(o.t)("and")),D:e.t(e.unref(o.t)("userAgreement")),E:e.o((o=>e.unref(r.redirect)({url:"/app/pages/auth/agreement?key=service"}))),F:e.o(T),G:e.o(y),H:e.o(k),I:e.sr(x,"1fba0830-2",{k:"popupRef"}),J:e.p({type:"dialog"}),K:e.sr(j,"1fba0830-3",{k:"bindMobileRef"}),L:e.s(n.themeColor())})}}}),l=e._export_sfc(a,[["__scopeId","data-v-1fba0830"]]);tt.createPage(l);
