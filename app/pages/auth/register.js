"use strict";const e=require("../../../common/vendor.js"),r=require("../../api/auth.js"),o=require("../../../stores/member.js"),a=require("../../../stores/config.js"),t=require("../../../hooks/useLogin.js"),l=require("../../../hooks/useCaptcha.js"),s=require("../../../locale/index.js"),n=require("../../../utils/common.js"),i=require("../../../utils/topTabbar.js");if(require("../../../utils/request.js"),require("../../api/member.js"),require("../../../stores/system.js"),require("../../api/system.js"),require("../../stores/diy.js"),require("../../../locale/i18n.js"),require("../../../locale/language.js"),require("../../../utils/pages.js"),!Array){(e.resolveComponent("u-input")+e.resolveComponent("u-form-item")+e.resolveComponent("u-icon")+e.resolveComponent("sms-code")+e.resolveComponent("u-form")+e.resolveComponent("u-checkbox")+e.resolveComponent("u-checkbox-group")+e.resolveComponent("uni-popup"))()}Math||((()=>"../../../node-modules/uview-plus/components/u-input/u-input.js")+(()=>"../../../node-modules/uview-plus/components/u-form-item/u-form-item.js")+(()=>"../../../node-modules/uview-plus/components/u-icon/u-icon.js")+(()=>"../../../components/sms-code/sms-code.js")+(()=>"../../../node-modules/uview-plus/components/u-form/u-form.js")+(()=>"../../../node-modules/uview-plus/components/u-checkbox/u-checkbox.js")+(()=>"../../../node-modules/uview-plus/components/u-checkbox-group/u-checkbox-group.js")+(()=>"../../../uni_modules/uni-popup/components/uni-popup/uni-popup.js"))();const u=e.defineComponent({__name:"register",setup(u){let p={};p=e.index.getMenuButtonBoundingClientRect();i.topTabar().setTopTabbarParam({title:"",topStatusBar:{bgColor:"#fff",textColor:"#333"}}),e.computed((()=>Object.keys(p).length?n.pxToRpx(Number(p.height))+n.pxToRpx(p.top)+n.pxToRpx(8)+"rpx":"auto"));const m=e.reactive({username:"",password:"",confirm_password:"",mobile:"",mobile_code:"",mobile_key:"",captcha_key:"",captcha_code:""}),d=e.ref(),c=()=>{d.value.close()},g=()=>{R.value=!0,d.value.close(),z()},b=e.ref(!0);e.onMounted((()=>{setTimeout((()=>{b.value=!1}),800)}));const h=e.ref(!0),f=e.ref(!0),v=()=>{h.value=!h.value},x=()=>{f.value=!f.value},_=o.useMemberStore(),y=a.useConfigStore(),w=e.ref("");e.onLoad((async r=>{await y.getLoginConfig(),n.getToken()||y.login.is_username||y.login.is_mobile||y.login.is_bind_mobile||(e.index.showToast({title:"商家未开启普通账号注册",icon:"none"}),setTimeout((()=>{n.redirect({url:"/app/pages/index/index",mode:"reLaunch"})}),100)),e.index.getStorageSync("pid")&&Object.assign(m,{pid:e.index.getStorageSync("pid")}),y.login.is_username?q.value="username":(y.login.is_mobile||y.login.is_bind_mobile)&&(q.value="mobile"),w.value=r.type}));const j=l.useCaptcha(m);j.refresh();const k=e.ref(!1),q=e.ref(""),C=()=>{R.value=!R.value},T=e.computed((()=>{const e=[];return y.login.is_username&&e.push({type:"username",title:s.t("usernameRegister")}),y.login.is_mobile&&!y.login.is_bind_mobile&&e.push({type:"mobile",title:s.t("mobileRegister")}),e})),P=e.computed((()=>({username:[{type:"string",required:"username"==q.value,message:s.t("usernamePlaceholder"),trigger:["blur","change"]},{validator:(r,o)=>!e.index.$u.test.number(o),message:s.t("usernameTips"),trigger:["change","blur"]}],password:{type:"string",required:"username"==q.value,message:s.t("passwordPlaceholder"),trigger:["blur","change"]},confirm_password:[{type:"string",required:"username"==q.value,message:s.t("confirmPasswordPlaceholder"),trigger:["blur","change"]},{validator:(e,r)=>r==m.password,message:s.t("confirmPasswordError"),trigger:["change","blur"]}],mobile:[{type:"string",required:"mobile"==q.value||y.login.is_bind_mobile,message:s.t("mobilePlaceholder"),trigger:["blur","change"]},{validator:(r,o)=>"mobile"!=q.value&&!y.login.is_bind_mobile||e.index.$u.test.mobile(o),message:s.t("mobileError"),trigger:["change","blur"]}],mobile_code:{type:"string",required:"mobile"==q.value||y.login.is_bind_mobile,message:s.t("codePlaceholder"),trigger:["blur","change"]},captcha_code:{type:"string",required:"username"==q.value,message:s.t("captchaPlaceholder"),trigger:["blur","change"]}}))),R=e.ref(!1),S=e.ref(null),z=()=>{S.value.validate().then((()=>{if(y.login.agreement_show&&!R.value)return d.value.open(),!1;if(k.value)return;k.value=!0;("username"==q.value?r.usernameRegister:r.mobileRegister)(m).then((e=>{_.setToken(e.data.token),t.useLogin().handleLoginBack()})).catch((()=>{k.value=!1,j.refresh()}))}))},V=()=>{const r=getCurrentPages();if(r.length>1){"app/pages/auth/login"==r[r.length-2].route?e.index.navigateBack({delta:1}):n.redirect({url:"/app/pages/auth/login",mode:"redirectTo"})}else n.redirect({url:"/app/pages/auth/login",mode:"redirectTo"})};return(r,o)=>e.e({a:q.value},q.value?e.e({b:e.t("username"==q.value?e.unref(s.t)("usernameRegister"):e.unref(s.t)("mobileRegister")),c:e.t("username"==q.value?e.unref(s.t)("usernameRegisterTip"):e.unref(s.t)("mobileRegisterTip")),d:"username"==q.value},"username"==q.value?e.e({e:e.o((e=>m.username=e)),f:e.p({border:"none",maxlength:"40",placeholder:e.unref(s.t)("usernamePlaceholder"),disabled:b.value,fontSize:"26rpx",placeholderClass:"!text-[var(--text-color-light9)] text-[26rpx]",modelValue:m.username}),g:e.p({label:"",prop:"username","border-bottom":!1}),h:m.password},m.password?{i:e.p({name:h.value?"eye-off":"eye-fill",color:"#b9b9b9",size:"20"}),j:e.o(v)}:{},{k:e.o((e=>m.password=e)),l:e.p({border:"none",password:h.value,maxlength:"40",placeholder:e.unref(s.t)("passwordPlaceholder"),disabled:b.value,fontSize:"26rpx",placeholderClass:"!text-[var(--text-color-light9)] text-[26rpx]",modelValue:m.password}),m:e.p({label:"",prop:"password","border-bottom":!1}),n:m.confirm_password},m.confirm_password?{o:e.p({name:f.value?"eye-off":"eye-fill",color:"#b9b9b9",size:"20"}),p:e.o(x)}:{},{q:e.o((e=>m.confirm_password=e)),r:e.p({border:"none",password:f.value,maxlength:"40",placeholder:e.unref(s.t)("confirmPasswordPlaceholder"),disabled:b.value,fontSize:"26rpx",placeholderClass:"!text-[var(--text-color-light9)] text-[26rpx]",modelValue:m.confirm_password}),s:e.p({label:"",prop:"confirm_password","border-bottom":!1})}):{},{t:"mobile"==q.value||e.unref(y).login.is_bind_mobile},"mobile"==q.value||e.unref(y).login.is_bind_mobile?e.e({v:e.o((e=>m.mobile=e)),w:e.p({border:"none",maxlength:"11",placeholder:e.unref(s.t)("mobilePlaceholder"),disabled:b.value,fontSize:"26rpx",placeholderClass:"!text-[var(--text-color-light9)] text-[26rpx]",modelValue:m.mobile}),x:e.p({label:"",prop:"mobile","border-bottom":!1}),y:e.unref(y).login.agreement_show},e.unref(y).login.agreement_show?{z:e.o((e=>m.mobile_key=e)),A:e.p({mobile:m.mobile,type:"login",isAgree:R.value,modelValue:m.mobile_key})}:{B:e.o((e=>m.mobile_key=e)),C:e.p({mobile:m.mobile,type:"login",modelValue:m.mobile_key})},{D:e.o((e=>m.mobile_code=e)),E:e.p({border:"none",maxlength:"4",placeholder:e.unref(s.t)("codePlaceholder"),disabled:b.value,fontSize:"26rpx",placeholderClass:"!text-[var(--text-color-light9)] text-[26rpx]",modelValue:m.mobile_code}),F:e.p({label:"",prop:"mobile_code","border-bottom":!1})}):{},{G:"username"==q.value},"username"==q.value?{H:e.unref(j).image.value,I:e.o((r=>e.unref(j).refresh())),J:e.o((e=>m.captcha_code=e)),K:e.p({border:"none",placeholder:e.unref(s.t)("captchaPlaceholder"),disabled:b.value,fontSize:"26rpx",placeholderClass:"!text-[var(--text-color-light9)] text-[26rpx]",modelValue:m.captcha_code}),L:e.p({label:"",prop:"captcha_code","border-bottom":!1})}:{},{M:e.sr(S,"0f328201-0",{k:"formRef"}),N:e.p({labelPosition:"left",model:m,errorType:"toast",rules:e.unref(P)}),O:e.unref(y).login.agreement_show},e.unref(y).login.agreement_show?{P:e.p({activeColor:"var(--primary-color)",checked:R.value,shape:"circle",size:"30rpx"}),Q:e.o(C),R:e.t(e.unref(s.t)("agreeTips")),S:e.t(e.unref(s.t)("privacyAgreement")),T:e.o((r=>e.unref(n.redirect)({url:"/app/pages/auth/agreement?key=privacy"}))),U:e.t(e.unref(s.t)("and")),V:e.t(e.unref(s.t)("userAgreement")),W:e.o((r=>e.unref(n.redirect)({url:"/app/pages/auth/agreement?key=service"}))),X:e.o(C)}:{},{Y:e.t(e.unref(s.t)("register")),Z:e.o(z),aa:e.unref(T).length>1},e.unref(T).length>1?{ab:e.t("username"==q.value?e.unref(s.t)("mobileRegister"):e.unref(s.t)("usernameRegister")),ac:e.o((e=>q.value="username"==q.value?"mobile":"username"))}:{},{ad:e.t(e.unref(s.t)("haveAccount")),ae:e.t(e.unref(s.t)("toLogin")),af:e.o(V),ag:e.t(e.unref(s.t)("agreeTips")),ah:e.t(e.unref(s.t)("privacyAgreement")),ai:e.o((r=>e.unref(n.redirect)({url:"/app/pages/auth/agreement?key=privacy"}))),aj:e.t(e.unref(s.t)("and")),ak:e.t(e.unref(s.t)("userAgreement")),al:e.o((r=>e.unref(n.redirect)({url:"/app/pages/auth/agreement?key=service"}))),am:e.o(C),an:e.o(g),ao:e.o(c),ap:e.sr(d,"0f328201-19",{k:"popupRef"}),aq:e.p({type:"dialog"}),ar:e.s(r.themeColor())}):{})}}),p=e._export_sfc(u,[["__scopeId","data-v-0f328201"]]);tt.createPage(p);
