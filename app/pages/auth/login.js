"use strict";const e=require("../../../common/vendor.js"),o=require("../../api/auth.js"),r=require("../../../stores/member.js"),a=require("../../../stores/config.js"),t=require("../../../hooks/useLogin.js"),l=require("../../../locale/index.js"),u=require("../../../utils/common.js"),n=require("../../../utils/topTabbar.js");if(require("../../../utils/request.js"),require("../../api/member.js"),require("../../../stores/system.js"),require("../../api/system.js"),require("../../stores/diy.js"),require("../../../locale/i18n.js"),require("../../../locale/language.js"),require("../../../utils/pages.js"),!Array){(e.resolveComponent("u-input")+e.resolveComponent("u-form-item")+e.resolveComponent("u-icon")+e.resolveComponent("sms-code")+e.resolveComponent("u-form")+e.resolveComponent("u-checkbox")+e.resolveComponent("u-checkbox-group")+e.resolveComponent("uni-popup"))()}Math||((()=>"../../../node-modules/uview-plus/components/u-input/u-input.js")+(()=>"../../../node-modules/uview-plus/components/u-form-item/u-form-item.js")+(()=>"../../../node-modules/uview-plus/components/u-icon/u-icon.js")+(()=>"../../../components/sms-code/sms-code.js")+(()=>"../../../node-modules/uview-plus/components/u-form/u-form.js")+(()=>"../../../node-modules/uview-plus/components/u-checkbox/u-checkbox.js")+(()=>"../../../node-modules/uview-plus/components/u-checkbox-group/u-checkbox-group.js")+(()=>"../../../uni_modules/uni-popup/components/uni-popup/uni-popup.js"))();const s=e.defineComponent({__name:"login",setup(s){let i={};i=e.index.getMenuButtonBoundingClientRect();n.topTabar().setTopTabbarParam({title:"",topStatusBar:{bgColor:"#fff",textColor:"#333"}}),e.computed((()=>Object.keys(i).length?u.pxToRpx(Number(i.height))+u.pxToRpx(i.top)+u.pxToRpx(8)+"rpx":"auto"));const p=e.ref(!0),m=r.useMemberStore(),c=a.useConfigStore(),d=e.ref(""),g=e.ref(!1),b=e.ref(!1),f=e.ref(),v=e.ref(!0),h=()=>{v.value=!v.value},x=()=>{f.value.close()},y=()=>{g.value=!0,f.value.close(),T()};e.onLoad((async o=>{await c.getLoginConfig(),u.getToken()||c.login.is_username||c.login.is_mobile||(e.index.showToast({title:"商家未开启普通账号登录",icon:"none"}),setTimeout((()=>{u.redirect({url:"/app/pages/index/index",mode:"reLaunch"})}),100)),o.type?"mobile"==o.type?c.login.is_mobile&&(d.value=o.type,e.index.getStorageSync("pid")&&Object.assign(_,{pid:e.index.getStorageSync("pid")})):"username"==o.type&&c.login.is_username&&(d.value=o.type):c.login.is_username?d.value="username":c.login.is_mobile&&(d.value="mobile")}));const _=e.reactive({username:"",password:"",mobile:"",mobile_code:"",mobile_key:""});e.onMounted((()=>{setTimeout((()=>{p.value=!1}),800)}));const j=()=>{g.value=!g.value},k=()=>{d.value="username"==d.value?"mobile":"username"},w=e.ref(!1),C=e.computed((()=>({username:{type:"string",required:"username"==d.value,message:l.t("usernamePlaceholder"),trigger:["blur","change"]},password:{type:"string",required:"username"==d.value,message:l.t("passwordPlaceholder"),trigger:["blur","change"]},mobile:[{type:"string",required:"mobile"==d.value,message:l.t("mobilePlaceholder"),trigger:["blur","change"]},{validator:(o,r)=>"mobile"!=d.value||e.index.$u.test.mobile(r),message:l.t("mobileError"),trigger:["change","blur"]}],mobile_code:{type:"string",required:"mobile"==d.value,message:l.t("codePlaceholder"),trigger:["blur","change"]}}))),q=e.ref(null),T=()=>{q.value.validate().then((()=>{if(c.login.agreement_show&&!g.value)return f.value.open(),!1;if(w.value)return;w.value=!0;("username"==d.value?o.usernameLogin:o.mobileLogin)(_).then((e=>{m.setToken(e.data.token),t.useLogin().handleLoginBack()})).catch((()=>{w.value=!1}))}))},L=()=>{const o=getCurrentPages();if(o.length>1){"app/pages/auth/index"==o[o.length-2].route?e.index.navigateBack({delta:1}):u.redirect({url:"/app/pages/auth/index",mode:"redirectTo"})}else u.redirect({url:"/app/pages/auth/index",mode:"redirectTo"})};return(o,r)=>e.e({a:d.value},d.value?e.e({b:e.t("username"==d.value?e.unref(l.t)("accountLogin"):e.unref(l.t)("mobileLogin")),c:e.t("username"==d.value?e.unref(l.t)("accountLoginTip"):e.unref(l.t)("mobileLoginTip")),d:"username"==d.value},"username"==d.value?e.e({e:e.o((e=>_.username=e)),f:e.p({border:"none",maxlength:"40",placeholder:e.unref(l.t)("usernamePlaceholder"),autocomplete:"off",disabled:p.value,fontSize:"26rpx",placeholderClass:"!text-[var(--text-color-light9)] text-[26rpx]",modelValue:_.username}),g:e.p({label:"",prop:"username","border-bottom":!1}),h:_.password},_.password?{i:e.p({name:v.value?"eye-off":"eye-fill",color:"#b9b9b9",size:"20"}),j:e.o(h)}:{},{k:e.o((e=>_.password=e)),l:e.p({border:"none",password:v.value,maxlength:"40",placeholder:e.unref(l.t)("passwordPlaceholder"),autocomplete:"new-password",disabled:p.value,fontSize:"26rpx",placeholderClass:"!text-[var(--text-color-light9)] text-[26rpx]",modelValue:_.password}),m:e.p({label:"",prop:"password","border-bottom":!1})}):{},{n:"mobile"==d.value},"mobile"==d.value?e.e({o:e.o((e=>_.mobile=e)),p:e.p({type:"number",maxlength:"11",border:"none",placeholder:e.unref(l.t)("mobilePlaceholder"),autocomplete:"off",disabled:p.value,fontSize:"26rpx",placeholderClass:"!text-[var(--text-color-light9)] text-[26rpx]",modelValue:_.mobile}),q:e.p({label:"",prop:"mobile","border-bottom":!1}),r:e.unref(c).login.agreement_show},e.unref(c).login.agreement_show?{s:e.o((e=>_.mobile_key=e)),t:e.p({mobile:_.mobile,type:"login",isAgree:g.value,modelValue:_.mobile_key})}:{v:e.o((e=>_.mobile_key=e)),w:e.p({mobile:_.mobile,type:"login",modelValue:_.mobile_key})},{x:e.o((e=>_.mobile_code=e)),y:e.p({type:"number",maxlength:"4",border:"none",fontSize:"26rpx",disabled:p.value,placeholder:e.unref(l.t)("codePlaceholder"),placeholderClass:"!text-[var(--text-color-light9)] text-[26rpx]",modelValue:_.mobile_code}),z:e.p({label:"",prop:"mobile_code","border-bottom":!1})}):{},{A:e.sr(q,"14ff93ab-0",{k:"formRef"}),B:e.p({labelPosition:"left",model:_,errorType:"toast",rules:e.unref(C)}),C:"username"==d.value},"username"==d.value?{D:e.t(e.unref(l.t)("resetpwd")),E:e.o((o=>e.unref(u.redirect)({url:"/app/pages/auth/resetpwd"})))}:{},{F:e.unref(c).login.agreement_show},e.unref(c).login.agreement_show?{G:e.p({activeColor:"var(--primary-color)",checked:g.value,shape:"circle",size:"30rpx"}),H:e.o(j),I:e.t(e.unref(l.t)("agreeTips")),J:e.t(e.unref(l.t)("privacyAgreement")),K:e.o((o=>e.unref(u.redirect)({url:"/app/pages/auth/agreement?key=privacy"}))),L:e.t(e.unref(l.t)("and")),M:e.t(e.unref(l.t)("userAgreement")),N:e.o((o=>e.unref(u.redirect)({url:"/app/pages/auth/agreement?key=service"}))),O:e.o(j)}:{},{P:e.t(e.unref(l.t)("login")),Q:e.unref(l.t)("logining"),R:e.o(T),S:"username"==d.value&&e.unref(c).login.is_mobile||"mobile"==d.value&&e.unref(c).login.is_username},"username"==d.value&&e.unref(c).login.is_mobile||"mobile"==d.value&&e.unref(c).login.is_username?{T:e.t("username"==d.value?e.unref(l.t)("mobileLogin"):e.unref(l.t)("accountLogin")),U:e.o(k)}:{},{V:e.t(e.unref(l.t)("noAccount")),W:e.t(e.unref(l.t)("toRegister")),X:e.o((o=>e.unref(u.redirect)({url:"/app/pages/auth/register",param:{type:d.value}}))),Y:"username"!=d.value?1:"",Z:"username"==d.value?1:"",aa:e.t(e.unref(l.t)("agreeTips")),ab:e.t(e.unref(l.t)("privacyAgreement")),ac:e.o((o=>e.unref(u.redirect)({url:"/app/pages/auth/agreement?key=privacy"}))),ad:e.t(e.unref(l.t)("and")),ae:e.t(e.unref(l.t)("userAgreement")),af:e.o((o=>e.unref(u.redirect)({url:"/app/pages/auth/agreement?key=service"}))),ag:e.o(j),ah:e.o(y),ai:e.o(x),aj:e.sr(f,"14ff93ab-14",{k:"popupRef"}),ak:e.p({type:"dialog"}),al:b.value},b.value?{am:e.t(e.unref(l.t)("oneClicklogin")),an:e.o(L)}:{},{ao:e.s(o.themeColor())}):{})}}),i=e._export_sfc(s,[["__scopeId","data-v-14ff93ab"]]);tt.createPage(i);
