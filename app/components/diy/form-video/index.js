"use strict";const e=require("../../../../common/vendor.js"),r=require("../../../stores/diy.js"),o=require("../../../../utils/common.js"),t=require("../../../api/system.js"),u=require("../../../../locale/index.js");if(require("../../../../hooks/useLogin.js"),require("../../../../utils/request.js"),require("../../../../stores/member.js"),require("../../../api/member.js"),require("../../../api/auth.js"),require("../../../../stores/config.js"),require("../../../../stores/system.js"),require("../../../../utils/pages.js"),require("../../../../locale/i18n.js"),require("../../../../locale/language.js"),!Array){e.resolveComponent("u-upload")()}Math;const a=e.defineComponent({__name:"index",props:["component","index","global"],setup(a,{expose:n}){const l=a,d=r.useDiyStore(),i=e.ref([]),f=e.ref(null),m=e.computed((()=>"decorate"==d.mode?d.value[l.index]:l.component));e.computed((()=>{let e="";return m.value&&m.value.uploadMode&&("shoot_and_album"==m.value.uploadMode?e="album":"shoot_only"==m.value.uploadMode&&(e="camera")),e}));const c=e.computed((()=>l.global)),s=e.computed((()=>{var e="";return e+="position:relative;",m.value.componentStartBgColor&&(m.value.componentStartBgColor&&m.value.componentEndBgColor?e+=`background:linear-gradient(${m.value.componentGradientAngle},${m.value.componentStartBgColor},${m.value.componentEndBgColor});`:e+="background-color:"+m.value.componentStartBgColor+";"),m.value.componentBgUrl&&(e+=`background-image:url('${o.img(m.value.componentBgUrl)}');`,e+="background-size: cover;background-repeat: no-repeat;"),m.value.topRounded&&(e+="border-top-left-radius:"+2*m.value.topRounded+"rpx;"),m.value.topRounded&&(e+="border-top-right-radius:"+2*m.value.topRounded+"rpx;"),m.value.bottomRounded&&(e+="border-bottom-left-radius:"+2*m.value.bottomRounded+"rpx;"),m.value.bottomRounded&&(e+="border-bottom-right-radius:"+2*m.value.bottomRounded+"rpx;"),e}));e.onMounted((()=>{h(),"decorate"==d.mode&&e.watch((()=>m.value),((e,r)=>{e&&e.componentName}))})),e.computed((()=>"decorate"===d.mode)),e.computed((()=>i.value.map((e=>({url:o.img(e)})))));const p=e=>{e.file.forEach((e=>{v(e)}))},v=e=>{t.uploadVideo({filePath:e.url,name:"file"}).then((e=>{m.value.field.value.push(e.data.url)})).catch((()=>{}))},g=e=>{m.value.field.value.splice(e.index,1)},b=()=>{let e=[];if(m.value.autofill){let r={title:"已自动填充"};e.push(r)}return e.forEach(((e,r,o)=>{if(r!=o.length-1){let e={title:"|"};o.push(e)}})),e},h=()=>{};return n({verify:()=>{const e={code:!0,message:""};return m.value.field.required&&(!m.value.field.value||m.value.field.value&&!m.value.field.value.length)&&(e.code=!1,e.message="请上传视频"),f.value=e,e},reset:()=>{m.value.field.value=[]}}),(r,t)=>e.e({a:e.unref(m).viewFormDetail},e.unref(m).viewFormDetail?e.e({b:"style-1"==e.unref(c).completeLayout},"style-1"==e.unref(c).completeLayout?{c:e.t(e.unref(m).field.name),d:e.f(e.unref(m).field.value,((t,u,a)=>({a:e.unref(o.img)(t),b:e.o((e=>r.handleImg(t,u))),c:u})))}:{},{e:"style-2"==e.unref(c).completeLayout},"style-2"==e.unref(c).completeLayout?{f:e.t(e.unref(m).field.name),g:e.f(e.unref(m).field.value,((t,u,a)=>({a:e.unref(o.img)(t),b:e.o((e=>r.handleImg(t,u))),c:u})))}:{}):e.e({h:"style-1"==e.unref(c).completeLayout},"style-1"==e.unref(c).completeLayout?e.e({i:e.t(e.unref(m).field.name),j:e.unref(m).textColor,k:2*e.unref(m).fontSize+"rpx",l:e.unref(m).fontWeight,m:e.t(e.unref(m).field.required?"*":""),n:"decorate"==e.unref(d).mode&&e.unref(m).isHidden},"decorate"==e.unref(d).mode&&e.unref(m).isHidden?{o:e.t(e.unref(u.t)("diyForm.hidden"))}:{},{p:e.unref(m).field.remark.text},e.unref(m).field.remark.text?{q:e.t(e.unref(m).field.remark.text),r:e.unref(m).field.remark.color,s:2*e.unref(m).field.remark.fontSize+"rpx"}:{},{t:f.value&&!f.value.code},f.value&&!f.value.code?{v:e.t(f.value.message)}:{},{w:e.f(e.unref(m).field.value,((r,t,u)=>({a:e.unref(o.img)(r),b:e.o((e=>g(t))),c:t}))),x:"shoot_and_album"==e.unref(m).uploadMode},"shoot_and_album"==e.unref(m).uploadMode?{y:e.o(p),z:e.p({accept:"image",capture:"album",maxCount:1})}:{A:e.o(p),B:e.p({accept:"image",maxCount:1,maxDuration:60,capture:"camera"})},{C:b().length},b().length?{D:e.f(b(),((o,t,u)=>({a:e.t(o.title),b:t,c:e.o((e=>r.eventFn(o.type)))})))}:{}):{},{E:"style-2"==e.unref(c).completeLayout},"style-2"==e.unref(c).completeLayout?e.e({F:"decorate"==e.unref(d).mode&&e.unref(m).isHidden},"decorate"==e.unref(d).mode&&e.unref(m).isHidden?{G:e.t(e.unref(u.t)("diyForm.hidden"))}:{},{H:e.unref(m).field.required},e.unref(m).field.required?{I:e.t(e.unref(m).field.required?"*":"")}:{},{J:e.t(e.unref(m).field.name),K:e.unref(m).textColor,L:2*e.unref(m).fontSize+"rpx",M:e.unref(m).fontWeight,N:"left"==e.unref(c).completeAlign?1:"",O:"right"==e.unref(c).completeAlign?1:"",P:e.f(e.unref(m).field.value,((r,t,u)=>({a:e.unref(o.img)(r),b:e.o((e=>g(t))),c:t}))),Q:"shoot_and_album"==e.unref(m).uploadMode},"shoot_and_album"==e.unref(m).uploadMode?{R:e.o(p),S:e.p({accept:"video",maxCount:1,capture:"album"})}:{T:e.o(p),U:e.p({accept:"video",maxCount:1,maxDuration:60,capture:"camera"})},{V:e.unref(c).borderControl?"":1,W:f.value&&!f.value.code},f.value&&!f.value.code?{X:e.t(f.value.message)}:{},{Y:e.unref(m).field.remark.text},e.unref(m).field.remark.text?{Z:e.t(e.unref(m).field.remark.text),aa:e.unref(m).field.remark.color,ab:2*e.unref(m).field.remark.fontSize+"rpx"}:{},{ac:b().length},b().length?{ad:e.f(b(),((o,t,u)=>({a:e.t(o.title),b:t,c:e.o((e=>r.eventFn(o.type)))})))}:{}):{},{ae:"decorate"==e.unref(d).mode},(e.unref(d).mode,{}),{af:e.s(e.unref(s))}))}}),n=e._export_sfc(a,[["__scopeId","data-v-d2b6b77b"]]);tt.createComponent(n);
