"use strict";const e=require("../../../../common/vendor.js"),o=require("../../../stores/diy.js"),t=require("../../../../utils/common.js"),r=require("../../../api/diy_form.js");require("../../../../hooks/useLogin.js"),require("../../../../utils/request.js"),require("../../../../stores/member.js"),require("../../../api/member.js"),require("../../../api/auth.js"),require("../../../../stores/config.js"),require("../../../../stores/system.js"),require("../../../api/system.js"),require("../../../../locale/index.js"),require("../../../../locale/i18n.js"),require("../../../../locale/language.js"),require("../../../../utils/pages.js");const n=e.defineComponent({__name:"index",props:["component","index","global"],setup(n){const a=n,u=o.useDiyStore(),l=e.ref(),d=e.computed((()=>"decorate"==u.mode?u.value[a.index]:a.component)),i=e.computed((()=>a.global)),m=e.computed((()=>{var e="";if(e+="position:relative;",d.value.componentStartBgColor&&d.value.componentEndBgColor?e+=`background:linear-gradient(${d.value.componentGradientAngle},${d.value.componentStartBgColor},${d.value.componentEndBgColor});`:d.value.componentStartBgColor?e+="background-color:"+d.value.componentStartBgColor+";":d.value.componentEndBgColor&&(e+="background-color:"+d.value.componentEndBgColor+";"),d.value.componentBgUrl&&(e+=`background-image:url('${t.img(d.value.componentBgUrl)}');`,e+="background-size: cover;background-repeat: no-repeat;"),d.value.topRounded&&(e+="border-top-left-radius:"+2*d.value.topRounded+"rpx;"),d.value.topRounded&&(e+="border-top-right-radius:"+2*d.value.topRounded+"rpx;"),d.value.bottomRounded&&(e+="border-bottom-left-radius:"+2*d.value.bottomRounded+"rpx;"),d.value.bottomRounded&&(e+="border-bottom-right-radius:"+2*d.value.bottomRounded+"rpx;"),"decorate"!=u.mode&&"hover_screen_bottom"==d.value.btnPosition){e+="position: fixed !important;";var o=l.value?l.value.height:0;e+="left: 0;",e+="right: 0;",o&&i.value.bottomTabBarSwitch?e+=`bottom: ${o}px;`:e+="bottom: 0;",d.value.pageStartBgColor&&(d.value.pageStartBgColor&&d.value.pageEndBgColor?e+=`background:linear-gradient(${d.value.pageGradientAngle},${d.value.pageStartBgColor},${d.value.pageEndBgColor});`:d.value.pageStartBgColor?e+=`background: ${d.value.pageStartBgColor};`:d.value.pageEndBgColor&&(e+=`background: ${d.value.pageEndBgColor};`)),d.value.margin&&(d.value.margin.top>0&&(e+="padding-top:"+2*d.value.margin.top+"rpx;"),o&&i.value.bottomTabBarSwitch?e+="padding-bottom:"+2*d.value.margin.bottom+"rpx;":e+=`padding-bottom: ${2*(d.value.margin.bottom+_.value)}rpx;`,e+="padding-right:"+2*d.value.margin.both+"rpx;",e+="padding-left:"+2*d.value.margin.both+"rpx;")}else"hover_screen_bottom"==d.value.btnPosition&&(e+="position: fixed !important;",e+="left: 0;",e+="right: 0;",e+="bottom: 0;");return e})),p=e.computed((()=>{var e="";return"hover_screen_bottom"==d.value.btnPosition&&(d.value.componentStartBgColor&&d.value.componentEndBgColor?e+=`background:linear-gradient(${d.value.componentGradientAngle},${d.value.componentStartBgColor},${d.value.componentEndBgColor});`:d.value.componentStartBgColor?e+="background-color:"+d.value.componentStartBgColor+";":d.value.componentEndBgColor&&(e+="background-color:"+d.value.componentEndBgColor+";")),e})),c=e.computed((()=>{var e="";return d.value.componentBgUrl&&(e+="position:absolute;top:0;right:0;left:0;bottom:0;",e+=`background: rgba(0,0,0,${d.value.componentBgAlpha/10});`,d.value.topRounded&&(e+="border-top-left-radius:"+2*d.value.topRounded+"rpx;"),d.value.topRounded&&(e+="border-top-right-radius:"+2*d.value.topRounded+"rpx;"),d.value.bottomRounded&&(e+="border-bottom-left-radius:"+2*d.value.bottomRounded+"rpx;"),d.value.bottomRounded&&(e+="border-bottom-right-radius:"+2*d.value.bottomRounded+"rpx;")),e})),s=e.computed((()=>{var e="";return e+=`color: ${d.value.resetBtn.color};`,e+=`background-color: ${d.value.resetBtn.bgColor};`,d.value.topElementRounded&&(e+="border-top-left-radius:"+2*d.value.topElementRounded+"rpx;"),d.value.topElementRounded&&(e+="border-top-right-radius:"+2*d.value.topElementRounded+"rpx;"),d.value.bottomElementRounded&&(e+="border-bottom-left-radius:"+2*d.value.bottomElementRounded+"rpx;"),d.value.bottomElementRounded&&(e+="border-bottom-right-radius:"+2*d.value.bottomElementRounded+"rpx;"),e})),v=e.computed((()=>{var e="";return e+=`color: ${d.value.submitBtn.color};`,e+=`background-color: ${d.value.submitBtn.bgColor};`,d.value.topElementRounded&&(e+="border-top-left-radius:"+2*d.value.topElementRounded+"rpx;"),d.value.topElementRounded&&(e+="border-top-right-radius:"+2*d.value.topElementRounded+"rpx;"),d.value.bottomElementRounded&&(e+="border-bottom-left-radius:"+2*d.value.bottomElementRounded+"rpx;"),d.value.bottomElementRounded&&(e+="border-bottom-right-radius:"+2*d.value.bottomElementRounded+"rpx;"),e})),g=e.computed((()=>{let e="";return e+=`padding-bottom: ${E.value}px;`,e})),b=e.ref([]);e.onMounted((()=>{f(),"decorate"==u.mode?e.watch((()=>d.value),((e,o)=>{e&&e.componentName})):(h(),e.watch((()=>u.value),((o,t)=>{if(o){let t=C(o);t.components.length&&e.index.setStorageSync("diyFormStorage_"+u.id,t)}}),{deep:!0})),e.nextTick$1((()=>{l.value=e.index.getStorageSync("tabbarInfo")}))}));const f=()=>{},h=()=>{for(let e=0;e<u.value.length;e++){let o=u.value[e];"diy_form"==o.componentType&&"FormSubmit"!=o.componentName&&b.value.push(o)}},x=e.ref(!1),R=()=>{if("decorate"===u.mode)return;let o=!0;for(let t=0;t<b.value.length;t++){let r=b.value[t];if(r.field.required||r.field.value){let t=`diy${r.componentName}Ref`,n=!1;if(u.componentRefs[t]){for(let o=0;o<u.componentRefs[t].length;o++){let r=u.componentRefs[t][o].verify();if(r&&!r.code){n=!0,e.index.showToast({title:r.message,icon:"none"});break}}if(n){o=!1;break}}}}if(!o)return;if(x.value)return;x.value=!0;let n=e.index.getStorageSync("diyFormStorage_"+u.id),a={};a=n?n.components:C(b.value).components;const l={form_id:u.id,value:a,relate_id:""};r.addFormRecord(l).then((o=>{e.index.removeStorageSync("diyFormStorage_"+u.id),t.redirect({url:"/app/pages/index/diy_form_result",param:{record_id:o.data,form_id:u.id},mode:"redirectTo"}),x.value=!1})).catch((()=>{x.value=!1}))},B=()=>{for(let e=0;e<b.value.length;e++){let o=b.value[e],t=`diy${o.componentName}Ref`;u.componentRefs[t]&&u.componentRefs[t].forEach((e=>{e.reset&&e.reset(o)}))}},C=e=>{let o={validTime:t.getValidTime(5),components:[]};return e.forEach((e=>{if("diy_form"==e.componentType&&"FormSubmit"!=e.componentName&&e.field.cache){let r=t.deepClone(e.field);delete r.remark,delete r.detailComponent,delete r.default,o.components.push({id:e.id,componentName:e.componentName,componentType:e.componentType,componentTitle:e.componentTitle,isHidden:e.isHidden,field:r})}})),o};let E=e.ref(0);const S=e.getCurrentInstance();let _=e.ref(0);return e.nextTick$1((()=>{const o=e.index.createSelectorQuery().in(S);o.select(".iphone-secure").boundingClientRect((e=>{_.value=e?e.height:0})).exec(),setTimeout((()=>{o.select(".submit-wrap").boundingClientRect((e=>{E.value=e?e.height:0})).exec()}),500)})),(o,t)=>e.e({a:e.s(e.unref(c)),b:e.t(e.unref(d).submitBtn.text),c:e.o(R),d:e.s(e.unref(v)),e:e.unref(d).resetBtn.control},e.unref(d).resetBtn.control?{f:e.t(e.unref(d).resetBtn.text),g:e.o(B),h:e.s(e.unref(s))}:{},{i:e.s(e.unref(p)),j:e.s(e.unref(m)),k:"hover_screen_bottom"==e.unref(d).btnPosition&&"decorate"!=e.unref(u).mode},"hover_screen_bottom"==e.unref(d).btnPosition&&"decorate"!=e.unref(u).mode?{l:e.s(e.unref(g))}:{},{m:"decorate"==e.unref(u).mode},(e.unref(u).mode,{}))}}),a=e._export_sfc(n,[["__scopeId","data-v-958939db"]]);tt.createComponent(a);
