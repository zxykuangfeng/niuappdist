"use strict";const e=require("../../../../common/vendor.js"),u=require("../../../../utils/common.js"),r=require("../../../../locale/index.js"),t=require("../../../stores/diy.js"),l=require("../../../api/system.js");if(require("../../../../utils/pages.js"),require("../../../../stores/member.js"),require("../../../api/member.js"),require("../../../../utils/request.js"),require("../../../api/auth.js"),require("../../../../stores/config.js"),require("../../../../stores/system.js"),require("../../../../locale/i18n.js"),require("../../../../locale/language.js"),require("../../../../hooks/useLogin.js"),!Array){e.resolveComponent("u-upload")()}Math;const o=e.defineComponent({__name:"index",props:["component","index","global"],setup(o,{expose:a}){const n=o,i=t.useDiyStore(),d=e.ref(null),f=e.computed((()=>"decorate"==i.mode?i.value[n.index]:n.component)),m=e.computed((()=>n.global)),c=e.computed((()=>{let e=[];return f.value&&f.value.uploadMode&&f.value.uploadMode.forEach(((u,r)=>{"take_pictures"==u&&-1==f.value.uploadMode.indexOf("camera")?e.push("camera"):"select_from_album"==u&&-1==f.value.uploadMode.indexOf("album")&&e.push("album")})),e})),p=()=>{let e=[];if(f.value.autofill){let u={title:"已自动填充"};e.push(u)}return e.forEach(((e,u,r)=>{if(u!=r.length-1){let e={title:"|"};r.push(e)}})),e},s=(r,t)=>{let l=[];f.value.field.value&&(l=Object.values(f.value.field.value).map((e=>u.img(e)))),e.index.previewImage({current:t,urls:l,indicator:"number",loop:!0})};e.onUnload((()=>{}));const v=e.computed((()=>{var e="";return e+="position:relative;",f.value.componentStartBgColor&&(f.value.componentStartBgColor&&f.value.componentEndBgColor?e+=`background:linear-gradient(${f.value.componentGradientAngle},${f.value.componentStartBgColor},${f.value.componentEndBgColor});`:e+="background-color:"+f.value.componentStartBgColor+";"),f.value.componentBgUrl&&(e+=`background-image:url('${u.img(f.value.componentBgUrl)}');`,e+="background-size: cover;background-repeat: no-repeat;"),f.value.topRounded&&(e+="border-top-left-radius:"+2*f.value.topRounded+"rpx;"),f.value.topRounded&&(e+="border-top-right-radius:"+2*f.value.topRounded+"rpx;"),f.value.bottomRounded&&(e+="border-bottom-left-radius:"+2*f.value.bottomRounded+"rpx;"),f.value.bottomRounded&&(e+="border-bottom-right-radius:"+2*f.value.bottomRounded+"rpx;"),e}));e.onMounted((()=>{x(),"decorate"==i.mode&&e.watch((()=>f.value),((e,u)=>{e&&e.componentName}))})),e.computed((()=>"decorate"===i.mode)),e.computed((()=>f.value.field.value.map((e=>({url:u.img(e)})))));const g=u=>{e.index.setStorageSync("sku_form_refresh",!0),u.file.forEach((e=>{h(e)}))},h=u=>{if(f.value.field.value.length>Number(f.value.limit))return e.index.showToast({title:`最多允许上传${f.value.limit}张图片`,icon:"none"}),!1;l.uploadImage({filePath:u.url,name:"file"}).then((e=>{f.value.field.value.length<Number(f.value.limit)&&f.value.field.value.push(e.data.url)})).catch((()=>{}))},b=e=>{f.value.field.value.splice(e.index,1)},x=()=>{};return a({verify:()=>{const e={code:!0,message:""};return f.value.field.required&&(!f.value.field.value||f.value.field.value&&!f.value.field.value.length)?(e.code=!1,e.message="请上传图片"):f.value.field.value&&f.value.field.value.length>Number(f.value.limit)&&(e.code=!1,e.message="图片上传数量已超出限制数量"),d.value=e,e},reset:()=>{f.value.field.value=[]}}),(t,l)=>e.e({a:e.unref(f).viewFormDetail},e.unref(f).viewFormDetail?e.e({b:"style-1"==e.unref(m).completeLayout},"style-1"==e.unref(m).completeLayout?{c:e.t(e.unref(f).field.name),d:e.f(e.unref(f).field.value,((r,t,l)=>({a:e.unref(u.img)(r),b:e.o((e=>s(0,t))),c:t})))}:{},{e:"style-2"==e.unref(m).completeLayout},"style-2"==e.unref(m).completeLayout?{f:e.t(e.unref(f).field.name),g:e.f(e.unref(f).field.value,((r,t,l)=>({a:e.unref(u.img)(r),b:e.o((e=>s(0,t))),c:t})))}:{}):e.e({h:"style-1"==e.unref(m).completeLayout},"style-1"==e.unref(m).completeLayout?e.e({i:e.t(e.unref(f).field.name),j:e.unref(f).textColor,k:2*e.unref(f).fontSize+"rpx",l:e.unref(f).fontWeight,m:e.t(e.unref(f).field.required?"*":""),n:"decorate"==e.unref(i).mode&&e.unref(f).isHidden},"decorate"==e.unref(i).mode&&e.unref(f).isHidden?{o:e.t(e.unref(r.t)("diyForm.hidden"))}:{},{p:e.unref(f).field.remark.text},e.unref(f).field.remark.text?{q:e.t(e.unref(f).field.remark.text),r:e.unref(f).field.remark.color,s:2*e.unref(f).field.remark.fontSize+"rpx"}:{},{t:d.value&&!d.value.code},d.value&&!d.value.code?{v:e.t(d.value.message)}:{},{w:e.f(e.unref(f).field.value,((r,t,l)=>({a:e.unref(u.img)(r),b:e.o((e=>b(t))),c:t}))),x:e.unref(f).uploadMode.length>1&&e.unref(f).field.value.length<=0},e.unref(f).uploadMode.length>1&&e.unref(f).field.value.length<=0?{y:e.o(g),z:e.p({accept:"image",multiple:!0,maxCount:9,capture:"camera"}),A:e.o(g),B:e.p({accept:"image",multiple:!0,maxCount:9,capture:"album"})}:e.unref(f).field.value.length<Number(e.unref(f).limit)?e.e({D:1==e.unref(f).uploadMode.length},1==e.unref(f).uploadMode.length?{E:e.unref(f).uploadMode.indexOf("take_pictures")>-1?1:"",F:-1==e.unref(f).uploadMode.indexOf("take_pictures")?1:"",G:e.t(e.unref(f).uploadMode.indexOf("take_pictures")>-1?"拍照上传":"从相册选择"),H:e.o(g),I:e.p({accept:"image",multiple:!0,capture:e.unref(c),maxCount:Number(e.unref(f).limit)})}:{J:e.t(e.unref(r.t)("diyForm.uploadTips")),K:e.o(g),L:e.p({accept:"image",multiple:!0,capture:e.unref(c),maxCount:Number(e.unref(f).limit)})}):{},{C:e.unref(f).field.value.length<Number(e.unref(f).limit),M:p().length},p().length?{N:e.f(p(),((u,r,t)=>({a:e.t(u.title),b:r,c:e.o((e=>{u.type}))})))}:{}):{},{O:"style-2"==e.unref(m).completeLayout},"style-2"==e.unref(m).completeLayout?e.e({P:"decorate"==e.unref(i).mode&&e.unref(f).isHidden},"decorate"==e.unref(i).mode&&e.unref(f).isHidden?{Q:e.t(e.unref(r.t)("diyForm.hidden"))}:{},{R:e.unref(f).field.required},e.unref(f).field.required?{S:e.t(e.unref(f).field.required?"*":"")}:{},{T:e.t(e.unref(f).field.name),U:e.unref(f).textColor,V:2*e.unref(f).fontSize+"rpx",W:e.unref(f).fontWeight,X:"left"==e.unref(m).completeAlign?1:"",Y:"right"==e.unref(m).completeAlign?1:"",Z:e.f(e.unref(f).field.value,((r,t,l)=>({a:e.unref(u.img)(r),b:e.o((e=>b(t))),c:t}))),aa:e.unref(f).field.value.length<Number(e.unref(f).limit)},e.unref(f).field.value.length<Number(e.unref(f).limit)?{ab:e.t(e.unref(r.t)("diyForm.uploadTips")),ac:e.o(g),ad:e.p({accept:"image",multiple:!0,capture:e.unref(c),maxCount:Number(e.unref(f).limit)})}:{},{ae:e.unref(m).borderControl?"":1,af:d.value&&!d.value.code},d.value&&!d.value.code?{ag:e.t(d.value.message)}:{},{ah:e.unref(f).field.remark.text},e.unref(f).field.remark.text?{ai:e.t(e.unref(f).field.remark.text),aj:e.unref(f).field.remark.color,ak:2*e.unref(f).field.remark.fontSize+"rpx"}:{},{al:p().length},p().length?{am:e.f(p(),((u,r,t)=>({a:e.t(u.title),b:r,c:e.o((e=>{u.type}))})))}:{}):{},{an:"decorate"==e.unref(i).mode},(e.unref(i).mode,{}),{ao:e.s(e.unref(v))}))}}),a=e._export_sfc(o,[["__scopeId","data-v-dcef37c9"]]);tt.createComponent(a);
