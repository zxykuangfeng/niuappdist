"use strict";const e=require("../../../../common/vendor.js"),t={name:"u-upload",mixins:[e.mpMixin,e.mixin,e.mixinUp,e.props$21],data:()=>({lists:[],isInCount:!0}),watch:{fileList:{handler(){this.formatFileList()},immediate:!0,deep:!0}},emits:["error","beforeRead","oversize","afterRead","delete","clickPreview"],methods:{addUnit:e.addUnit,addStyle:e.addStyle,formatFileList(){const{fileList:t=[],maxCount:i}=this,s=t.map((t=>Object.assign(Object.assign({},t),{isImage:"image"===this.accept||e.test.image(t.url||t.thumb),isVideo:"video"===this.accept||e.test.video(t.url||t.thumb),deletable:"boolean"==typeof t.deletable?t.deletable:this.deletable})));this.lists=s,this.isInCount=s.length<i},chooseFile(){const{maxCount:t,multiple:i,lists:s,disabled:a}=this;if(a)return;let o;try{o=e.test.array(this.capture)?this.capture:this.capture.split(",")}catch(l){o=[]}e.chooseFile(Object.assign({accept:this.accept,multiple:this.multiple,capture:o,compressed:this.compressed,maxDuration:this.maxDuration,sizeType:this.sizeType,camera:this.camera},{maxCount:t-s.length})).then((e=>{this.onBeforeRead(i?e:e[0])})).catch((e=>{this.$emit("error",e)}))},onBeforeRead(t){const{beforeRead:i,useBeforeRead:s}=this;let a=!0;e.test.func(i)&&(a=i(t,this.getDetail())),s&&(a=new Promise(((e,i)=>{this.$emit("beforeRead",Object.assign(Object.assign({file:t},this.getDetail()),{callback:t=>{t?e():i()}}))}))),a&&(e.test.promise(a)?a.then((e=>this.onAfterRead(e||t))):this.onAfterRead(t))},getDetail(e){return{name:this.name,index:null==e?this.fileList.length:e}},onAfterRead(e){const{maxSize:t,afterRead:i}=this;(Array.isArray(e)?e.some((e=>e.size>t)):e.size>t)?this.$emit("oversize",Object.assign({file:e},this.getDetail())):("function"==typeof i&&i(e,this.getDetail()),this.$emit("afterRead",Object.assign({file:e},this.getDetail())))},deleteItem(e){this.$emit("delete",Object.assign(Object.assign({},this.getDetail(e)),{file:this.fileList[e]}))},onPreviewImage(t){t.isImage&&this.previewFullImage&&e.index.previewImage({urls:this.lists.filter((t=>"image"===this.accept||e.test.image(t.url||t.thumb))).map((e=>e.url||e.thumb)),current:t.url||t.thumb,fail(){e.toast("预览图片失败")}})},onPreviewVideo(e){this.data.previewFullImage&&(e.currentTarget.dataset,this.data)},onClickPreview(e){const{index:t}=e.currentTarget.dataset,i=this.data.lists[t];if(this.data.previewFullImage){if("video"===i.type)this.onPreviewVideo(e);this.$emit("clickPreview",Object.assign(Object.assign({},i),this.getDetail(t)))}}}};if(!Array){(e.resolveComponent("u-icon")+e.resolveComponent("u-loading-icon"))()}Math||((()=>"../u-icon/u-icon.js")+(()=>"../u-loading-icon/u-loading-icon.js"))();const i=e._export_sfc(t,[["render",function(t,i,s,a,o,l){return e.e({a:t.previewImage},t.previewImage?{b:e.f(o.lists,((i,s,a)=>e.e({a:i.isImage||i.type&&"image"===i.type},i.isImage||i.type&&"image"===i.type?{b:i.thumb||i.url,c:t.imageMode,d:e.o((e=>l.onPreviewImage(i))),e:e.s({width:l.addUnit(t.width),height:l.addUnit(t.height)})}:{f:"4619c499-0-"+a,g:e.p({color:"#80CBF9",size:"26",name:i.isVideo||i.type&&"video"===i.type?"movie":"folder"}),h:e.t(i.isVideo||i.type&&"video"===i.type?"视频":"文件"),i:e.o((e=>l.onClickPreview(e,i)))},{j:"uploading"===i.status||"failed"===i.status},"uploading"===i.status||"failed"===i.status?e.e({k:"failed"===i.status},"failed"===i.status?{l:"4619c499-1-"+a,m:e.p({name:"close-circle",color:"#ffffff",size:"25"})}:{n:"4619c499-2-"+a,o:e.p({size:"22",mode:"circle",color:"#ffffff"})},{p:i.message},i.message?{q:e.t(i.message)}:{}):{},{r:"uploading"!==i.status&&(t.deletable||i.deletable)},"uploading"!==i.status&&(t.deletable||i.deletable)?{s:"4619c499-3-"+a,t:e.p({name:"close",color:"#ffffff",size:"10"}),v:e.o((e=>l.deleteItem(s)))}:{},{w:"success"===i.status},"success"===i.status?{x:"4619c499-4-"+a,y:e.p({name:"checkmark",color:"#ffffff",size:"12"})}:{},{z:s})))}:{},{c:o.isInCount},o.isInCount?e.e({d:t.$slots.default||t.$slots.$default},t.$slots.default||t.$slots.$default?{e:e.o(((...e)=>l.chooseFile&&l.chooseFile(...e)))}:e.e({f:e.p({name:t.uploadIcon,size:"26",color:t.uploadIconColor}),g:t.uploadText},t.uploadText?{h:e.t(t.uploadText)}:{},{i:t.disabled?"":"u-upload__button--hover",j:e.o(((...e)=>l.chooseFile&&l.chooseFile(...e))),k:e.n(t.disabled&&"u-upload__button--disabled"),l:e.s({width:l.addUnit(t.width),height:l.addUnit(t.height)})})):{},{m:e.s(l.addStyle(t.customStyle))})}],["__scopeId","data-v-4619c499"]]);tt.createComponent(i);
