"use strict";const t=require("../../../../common/vendor.js"),e={name:"u-calendar",mixins:[t.mpMixin,t.mixin,t.props$37],components:{uHeader:()=>"./header.js",uMonth:()=>"./month.js"},data:()=>({months:[],monthIndex:0,listHeight:0,selected:[],scrollIntoView:"",scrollIntoViewScroll:"",scrollTop:0,innerFormatter:t=>t}),watch:{scrollIntoView:{immediate:!0,handler(t){}},selectedChange:{immediate:!0,handler(t){this.setMonth()}},show:{immediate:!0,handler(t){t?this.setMonth():this.scrollIntoView=""}}},computed:{innerMaxDate(){return t.test.number(this.maxDate)?Number(this.maxDate):this.maxDate},innerMinDate(){return t.test.number(this.minDate)?Number(this.minDate):this.minDate},selectedChange(){return[this.innerMinDate,this.innerMaxDate,this.defaultDate]},subtitle(){return this.months.length?`${this.months[this.monthIndex].year}年${this.months[this.monthIndex].month}月`:""},buttonDisabled(){return"range"===this.mode&&this.selected.length<=1}},mounted(){this.start=Date.now(),this.init()},emits:["confirm","close"],methods:{addUnit:t.addUnit,setFormatter(t){this.innerFormatter=t},monthSelected(t,e="init"){if(this.selected=t,!this.showConfirm&&("multiple"===this.mode||"single"===this.mode||"range"===this.mode&&this.selected.length>=2)){if("init"===e)return;"tap"===e&&this.$emit("confirm",this.selected)}},init(){if(this.innerMaxDate&&this.innerMinDate&&new Date(this.innerMaxDate).getTime()<new Date(this.innerMinDate).getTime())return t.error();this.listHeight=5*this.rowHeight+30,this.setMonth()},close(){this.$emit("close")},confirm(){this.buttonDisabled||this.$emit("confirm",this.selected)},getMonths(e,o){const n=t.dayjs(e).year(),s=t.dayjs(e).month()+1;return 12*(t.dayjs(o).year()-n)+(t.dayjs(o).month()+1-s)+1},setMonth(){const e=this.innerMinDate||t.dayjs().valueOf(),o=this.innerMaxDate||t.dayjs(e).add(this.monthNum-1,"month").valueOf(),n=t.range(1,this.monthNum,this.getMonths(e,o));this.months=[];for(let s=0;s<n;s++)this.months.push({date:new Array(t.dayjs(e).add(s,"month").daysInMonth()).fill(1).map(((n,a)=>{let i=a+1;const h=t.dayjs(e).add(s,"month").date(i).day(),r=t.dayjs(e).add(s,"month").date(i).format("YYYY-MM-DD");let l="";if(this.showLunar){l=t.Calendar.solar2lunar(t.dayjs(r).year(),t.dayjs(r).month()+1,t.dayjs(r).date()).IDayCn}let m={day:i,week:h,disabled:t.dayjs(r).isBefore(t.dayjs(e).format("YYYY-MM-DD"))||t.dayjs(r).isAfter(t.dayjs(o).format("YYYY-MM-DD")),date:new Date(r),bottomInfo:l,dot:!1,month:t.dayjs(e).add(s,"month").month()+1};return(this.formatter||this.innerFormatter)(m)})),month:t.dayjs(e).add(s,"month").month()+1,year:t.dayjs(e).add(s,"month").year()})},scrollIntoDefaultMonth(e){const o=this.months.findIndex((({year:o,month:n})=>`${o}-${n=t.padZero(n)}`===e));-1!==o&&this.$nextTick((()=>{this.scrollIntoView=`month-${o}`,this.scrollIntoViewScroll=this.scrollIntoView}))},onScroll(t){const e=Math.max(0,t.detail.scrollTop);for(let o=0;o<this.months.length;o++)e>=(this.months[o].top||this.listHeight)&&(this.monthIndex=o,this.scrollIntoViewScroll=`month-${o}`)},updateMonthTop(e=[]){if(e.map(((t,e)=>{this.months[e].top=t})),!this.defaultDate){const e=t.dayjs().format("YYYY-MM");return void this.scrollIntoDefaultMonth(e)}let o=t.dayjs().format("YYYY-MM");o=t.test.array(this.defaultDate)?t.dayjs(this.defaultDate[0]).format("YYYY-MM"):t.dayjs(this.defaultDate).format("YYYY-MM"),this.scrollIntoDefaultMonth(o)}}};if(!Array){(t.resolveComponent("uHeader")+t.resolveComponent("uMonth")+t.resolveComponent("u-button")+t.resolveComponent("u-popup"))()}Math||((()=>"../u-button/u-button.js")+(()=>"../u-popup/u-popup.js"))();const o=t._export_sfc(e,[["render",function(e,o,n,s,a,i){return t.e({a:t.p({title:e.title,subtitle:i.subtitle,showSubtitle:e.showSubtitle,showTitle:e.showTitle}),b:t.sr("month","43e34f6c-2,43e34f6c-0"),c:t.o(i.monthSelected),d:t.o(i.updateMonthTop),e:t.p({color:e.color,rowHeight:e.rowHeight,showMark:e.showMark,months:a.months,mode:e.mode,maxCount:e.maxCount,startText:e.startText,endText:e.endText,defaultDate:e.defaultDate,minDate:i.innerMinDate,maxDate:i.innerMaxDate,maxMonth:e.monthNum,readonly:e.readonly,maxRange:e.maxRange,rangePrompt:e.rangePrompt,showRangePrompt:e.showRangePrompt,allowSameDay:e.allowSameDay}),f:i.addUnit(a.listHeight),g:t.o(((...t)=>i.onScroll&&i.onScroll(...t))),h:a.scrollTop,i:a.scrollIntoView,j:e.showConfirm},e.showConfirm?{k:t.o(i.confirm),l:t.p({shape:"circle",text:i.buttonDisabled?e.confirmDisabledText:e.confirmText,color:e.color,disabled:i.buttonDisabled})}:{},{m:t.o(i.close),n:t.p({show:e.show,mode:"bottom",closeable:!0,round:e.round,closeOnClickOverlay:e.closeOnClickOverlay})})}],["__scopeId","data-v-43e34f6c"]]);tt.createComponent(o);
