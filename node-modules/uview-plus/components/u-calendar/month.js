"use strict";const t=require("../../../../common/vendor.js"),e={name:"u-calendar-month",mixins:[t.mpMixin,t.mixin],props:{showMark:{type:Boolean,default:!0},color:{type:String,default:"#3c9cff"},months:{type:Array,default:()=>[]},mode:{type:String,default:"single"},rowHeight:{type:[String,Number],default:58},maxCount:{type:[String,Number],default:1/0},startText:{type:String,default:"开始"},endText:{type:String,default:"结束"},defaultDate:{type:[Array,String,Date],default:null},minDate:{type:[String,Number],default:0},maxDate:{type:[String,Number],default:0},maxMonth:{type:[String,Number],default:2},readonly:{type:Boolean,default:()=>t.defProps.calendar.readonly},maxRange:{type:[Number,String],default:1/0},rangePrompt:{type:String,default:""},showRangePrompt:{type:Boolean,default:!0},allowSameDay:{type:Boolean,default:!1}},data:()=>({width:0,item:{},selected:[]}),watch:{selectedChange:{immediate:!0,handler(t){this.setDefaultDate()}}},computed:{selectedChange(){return[this.minDate,this.maxDate,this.defaultDate]},dayStyle(e,s,a){return(e,s,a)=>{const d={};let i=a.week;const o=Number(parseFloat(this.width/7).toFixed(3).slice(0,-1));return d.height=t.addUnit(this.rowHeight),0===s&&(i=(0===i?7:i)-1,d.marginLeft=t.addUnit(i*o)),"range"===this.mode&&(d.paddingLeft=0,d.paddingRight=0,d.paddingBottom=0,d.paddingTop=0),d}},daySelectStyle(){return(e,s,a)=>{let d=t.dayjs(a.date).format("YYYY-MM-DD"),i={};if(this.selected.some((t=>this.dateSame(t,d)))&&(i.backgroundColor=this.color),"single"===this.mode)d===this.selected[0]&&(i.borderTopLeftRadius="3px",i.borderBottomLeftRadius="3px",i.borderTopRightRadius="3px",i.borderBottomRightRadius="3px");else if("range"===this.mode)if(this.selected.length>=2){const e=this.selected.length-1;this.dateSame(d,this.selected[0])&&(i.borderTopLeftRadius="3px",i.borderBottomLeftRadius="3px"),this.dateSame(d,this.selected[e])&&(i.borderTopRightRadius="3px",i.borderBottomRightRadius="3px"),t.dayjs(d).isAfter(t.dayjs(this.selected[0]))&&t.dayjs(d).isBefore(t.dayjs(this.selected[e]))&&(i.backgroundColor=t.colorGradient(this.color,"#ffffff",100)[90],i.opacity=.7)}else 1===this.selected.length&&(i.borderTopLeftRadius="3px",i.borderBottomLeftRadius="3px");else this.selected.some((t=>this.dateSame(t,d)))&&(i.borderTopLeftRadius="3px",i.borderBottomLeftRadius="3px",i.borderTopRightRadius="3px",i.borderBottomRightRadius="3px");return i}},textStyle(){return e=>{const s=t.dayjs(e.date).format("YYYY-MM-DD"),a={};if(this.selected.some((t=>this.dateSame(t,s)))&&(a.color="#ffffff"),"range"===this.mode){const e=this.selected.length-1;t.dayjs(s).isAfter(t.dayjs(this.selected[0]))&&t.dayjs(s).isBefore(t.dayjs(this.selected[e]))&&(a.color=this.color)}return a}},getBottomInfo(){return(e,s,a)=>{const d=t.dayjs(a.date).format("YYYY-MM-DD"),i=a.bottomInfo;if("range"===this.mode&&this.selected.length>0){if(1===this.selected.length)return this.dateSame(d,this.selected[0])?this.startText:i;{const t=this.selected.length-1;return this.dateSame(d,this.selected[0])&&this.dateSame(d,this.selected[1])&&1===t?`${this.startText}/${this.endText}`:this.dateSame(d,this.selected[0])?this.startText:this.dateSame(d,this.selected[t])?this.endText:i}}return i}}},mounted(){this.init()},methods:{init(){this.$emit("monthSelected",this.selected),this.$nextTick((()=>{t.sleep(10).then((()=>{this.getWrapperWidth(),this.getMonthRect()}))}))},dateSame:(e,s)=>t.dayjs(e).isSame(t.dayjs(s)),getWrapperWidth(){this.$uGetRect(".u-calendar-month-wrapper").then((t=>{this.width=t.width}))},getMonthRect(){const t=this.months.map(((t,e)=>this.getMonthRectByPromise(`u-calendar-month-${e}`)));Promise.all(t).then((t=>{let e=1;const s=[];for(let a=0;a<this.months.length;a++)s[a]=e,e+=t[a].height;this.$emit("updateMonthTop",s)}))},getMonthRectByPromise(t){return new Promise((e=>{this.$uGetRect(`.${t}`).then((t=>{e(t)}))}))},clickHandler(e,s,a){if(this.readonly)return;this.item=a;const d=t.dayjs(a.date).format("YYYY-MM-DD");if(a.disabled)return;let i=t.deepClone(this.selected);if("single"===this.mode)i=[d];else if("multiple"===this.mode)if(i.some((t=>this.dateSame(t,d)))){const t=i.findIndex((t=>t===d));i.splice(t,1)}else i.length<this.maxCount&&i.push(d);else if(0===i.length||i.length>=2)i=[d];else if(1===i.length){const e=i[0];if(t.dayjs(d).isBefore(e))i=[d];else if(t.dayjs(d).isAfter(e)){if(t.dayjs(t.dayjs(d).subtract(this.maxRange,"day")).isAfter(t.dayjs(i[0]))&&this.showRangePrompt)return void(this.rangePrompt?t.toast(this.rangePrompt):t.toast(`选择天数不能超过 ${this.maxRange} 天`));i.push(d);const e=i[0],s=i[1],a=[];let o=0;do{a.push(t.dayjs(e).add(o,"day").format("YYYY-MM-DD")),o++}while(t.dayjs(e).add(o,"day").isBefore(t.dayjs(s)));a.push(s),i=a}else{if(i[0]===d&&!this.allowSameDay)return;i.push(d)}}this.setSelected(i)},setDefaultDate(){if(!this.defaultDate){const e=[t.dayjs().format("YYYY-MM-DD")];return this.setSelected(e,!1)}let e=[];const s=this.minDate||t.dayjs().format("YYYY-MM-DD"),a=this.maxDate||t.dayjs(s).add(this.maxMonth-1,"month").format("YYYY-MM-DD");if("single"===this.mode)e=t.test.array(this.defaultDate)?[this.defaultDate[0]]:[t.dayjs(this.defaultDate).format("YYYY-MM-DD")];else{if(!t.test.array(this.defaultDate))return;e=this.defaultDate}e=e.filter((e=>t.dayjs(e).isAfter(t.dayjs(s).subtract(1,"day"))&&t.dayjs(e).isBefore(t.dayjs(a).add(1,"day")))),this.setSelected(e,!1)},setSelected(t,e=!0){this.selected=t,e&&this.$emit("monthSelected",this.selected,"tap")}}};const s=t._export_sfc(e,[["render",function(e,s,a,d,i,o){return{a:t.f(a.months,((e,s,d)=>t.e({a:0!==s},0!==s?{b:t.t(e.year),c:t.t(e.month)}:{},a.showMark?{d:t.t(e.month)}:{},{e:t.f(e.date,((e,a,d)=>t.e({a:t.t(e.day),b:t.n(e.disabled&&"u-calendar-month__days__day__select__info--disabled"),c:t.s(o.textStyle(e)),d:o.getBottomInfo(s,a,e)},o.getBottomInfo(s,a,e)?{e:t.t(o.getBottomInfo(s,a,e)),f:t.n(e.disabled&&"u-calendar-month__days__day__select__buttom-info--disabled"),g:t.s(o.textStyle(e))}:{},{h:e.dot},(e.dot,{}),{i:t.s(o.daySelectStyle(s,a,e)),j:a,k:t.s(o.dayStyle(s,a,e)),l:t.o((t=>o.clickHandler(s,a,e))),m:t.n(e.selected&&"u-calendar-month__days__day__select--selected")}))),f:s,g:t.n(`u-calendar-month-${s}`),h:`u-calendar-month-${s}`,i:`month-${s}`}))),b:a.showMark}}],["__scopeId","data-v-0ae350d7"]]);tt.createComponent(s);
