"use strict";const e=require("../common/vendor.js"),t=require("./pages.js"),r=require("../app/stores/diy.js"),n=require("../stores/member.js"),o=require("../stores/system.js"),s=require("../stores/config.js"),i=n=>{if("decorate"==r.useDiyStore().mode)return;let{url:i,mode:c,param:l,success:u,fail:p,complete:m}=n;a()||-1==t.getNeedLoginPages().indexOf(i)||(s.useConfigStore(),o.useSystemStore()),c=c||"navigateTo";switch(t.getTabbarPages().includes(i)&&(c="switchTab"),"switchTab"!=c&&l&&Object.keys(l).length&&(i+=e.index.$u.queryParams(l)),c){case"switchTab":e.index.switchTab({url:i,success:()=>{u&&u()},fail:()=>{p&&p()},complete:()=>{m&&m()}});break;case"navigateTo":e.index.navigateTo({url:i,success:()=>{u&&u()},fail:()=>{p&&p()},complete:()=>{m&&m()}});break;case"reLaunch":e.index.reLaunch({url:i,success:()=>{u&&u()},fail:()=>{p&&p()},complete:()=>{m&&m()}});break;case"redirectTo":e.index.redirectTo({url:i,success:()=>{u&&u()},fail:()=>{p&&p()},complete:()=>{m&&m()}})}};function a(){return n.useMemberStore().token}const c=e=>"function"==typeof Array.isArray?Array.isArray(e):"[object Array]"===Object.prototype.toString.call(e);function l(e){const t=/^rgba?\((\d+),\s*(\d+),\s*(\d+)(,\s*\d*\.?\d+)?\)$/;for(let r in e)if(t.test(e[r])){const t=e[r].replace("rgba(","").replace(")","").split(","),n=parseInt(t[0].trim(),10),o=parseInt(t[1].trim(),10),s=parseInt(t[2].trim(),10),i=parseFloat(t[3].trim());e[r]=u(n,o,s,i)}return e}function u(e,t,r,n){let o=Math.round(255*(1-n)+n*e),s=Math.round(255*(1-n)+n*t),i=Math.round(255*(1-n)+n*r),a=function(e){let t=e.toString(16);return 1==t.length?"0"+t:t};return("#"+a(o)+a(s)+a(i)).toUpperCase()}exports.copy=function(t,r){e.index.setClipboardData({data:t,success:()=>{"function"==typeof r&&r()},fail:t=>{if(t.errMsg&&t.errno)if(104==t.errno){let t="用户未授权隐私权限，设置剪贴板数据失败";e.index.showToast({title:t,icon:"none"})}else if(112==t.errno){let t="隐私协议中未声明，设置剪贴板数据失败";e.index.showToast({title:t,icon:"none"})}else e.index.showToast({title:t.errMsg,icon:"none"})}})},exports.currRoute=()=>{const e=getCurrentPages(),t=e[e.length-1];return t?t.route:""},exports.currShareRoute=()=>{const e=getCurrentPages();if(0==e.length)return{path:"/",params:{}};let t=e[e.length-1].route,r=e[e.length-1].options||{},n={};for(let o in r)n[o]=r[o];return{path:"/"+t,params:n}},exports.deepClone=function e(t){if([null,void 0,NaN,!1].includes(t))return t;if("object"!=typeof t&&"function"!=typeof t)return t;const r=c(t)?[]:{};for(const n in t)t.hasOwnProperty(n)&&(r[n]="object"==typeof t[n]?e(t[n]):t[n]);return r},exports.diyRedirect=t=>{"decorate"!=r.useDiyStore().mode&&null!=t&&1!=Object.keys(t).length&&(!t.url||-1==t.url.indexOf("https")&&-1==t.url.indexOf("http")?t.appid?e.index.navigateToMiniProgram({appId:t.appid,path:t.page}):"DIY_MAKE_PHONE_CALL"==t.name&&t.mobile?e.index.makePhoneCall({phoneNumber:t.mobile,success:e=>{},fail:e=>{}}):i({url:t.url}):i({url:"/app/pages/webview/index",param:{src:encodeURIComponent(t.url)}}))},exports.getAppChannel=function(){},exports.getSiteId=function(e){return e},exports.getToken=a,exports.getValidTime=function(e=1){var t=new Date;return t.setSeconds(60*e),parseInt(t.getTime()/1e3)},exports.goback=function(t){let{url:r,mode:n,param:o,title:s}=t;e.index.showToast({title:s,icon:"none"}),setTimeout((()=>{getCurrentPages().length>1?e.index.navigateBack({delta:1}):i({url:r,param:o||{},mode:n||"redirectTo"})}),600)},exports.img=function(e){let t="http://ssz.sszwl.com";return"string"==typeof e&&e.startsWith("/")&&(e=e.replace(/^\//,"")),"string"==typeof t&&t.endsWith("/")&&(t=t.slice(0,-1)),!(r=e)||-1==r.indexOf("http://")&&-1==r.indexOf("https://")?`${t}/${e}`:e;var r},exports.isWeixinBrowser=function(){return!1},exports.mobileConceal=function(e){return e.substring(0,3)+"****"+e.substr(e.length-4)},exports.mobileHide=function(e){return e.replace(/(\d{3})\d{4}(\d{4})/,"$1****$2")},exports.moneyFormat=function(e){return isNaN(parseFloat(e))?e:parseFloat(e).toFixed(2)},exports.pxToRpx=function(t){const r=e.index.getSystemInfoSync().screenWidth;return 750*Number.parseInt(t)/r},exports.redirect=i,exports.removeToken=function(){e.index.removeStorageSync("wapToken")},exports.setThemeColor=function(t){let r=t.split("/"),n=r[0]?0:1,o="addon"==r[n]?r[n+1]:"app";const i=s.useConfigStore();i.addon!=o&&(i.addon=o);const a=e.index.getStorageSync("theme_color_list"),c=e.index.getStorageSync("current_theme_color");let u={};if("app"!=o)try{u=a[o],u&&u.theme?(i.themeColor=l(u.theme),e.index.setStorageSync("current_theme_color",JSON.stringify(l(u.theme)))):!u&&c?i.themeColor="":(u=a.app||Object.values(a)[0],i.themeColor=l(u.theme),e.index.setStorageSync("current_theme_color",JSON.stringify(l(u.theme))))}catch(p){!c&&a&&a.length>0?(u=a.app||Object.values(a)[0],i.themeColor=l(u.theme),e.index.setStorageSync("current_theme_color",JSON.stringify(l(u.theme)))):i.themeColor=""}else!c&&a&&a.length>0&&(u=a.app||Object.values(a)[0],i.themeColor=l(u.theme),e.index.setStorageSync("current_theme_color",JSON.stringify(l(u.theme))))},exports.setToken=function(t){e.index.setStorageSync("wapToken",t)},exports.timeStampTurnTime=function(e,t=""){if(null!=e&&""!=e&&e>0){var r=new Date;r.setTime(1e3*e);var n=r.getFullYear(),o=r.getMonth()+1;o=o<10?"0"+o:o;var s=r.getDate();s=s<10?"0"+s:s;var i=r.getHours();i=i<10?"0"+i:i;var a=r.getMinutes(),c=r.getSeconds();return a=a<10?"0"+a:a,c=c<10?"0"+c:c,t?"yearMonthDay"==t?n+"年"+o+"月"+s+"日":n+"-"+o+"-"+s:n+"-"+o+"-"+s+" "+i+":"+a+":"+c}return""},exports.timeTurnTimeStamp=function(e){let t,r;try{let n=e.replace("年","-").replace("月","-").replace("日","");r=new Date(n),t=r.getTime()}catch(n){try{r=new Date(e),t=r.getTime()}catch(o){try{r=new Date(e.replace(/\//g,"-")),t=r.getTime()}catch(s){try{let n=e.replace("年","-").replace("月","-").replace("日"," ").replace("时",":").replace("分","");r=new Date(n),t=r.getTime()}catch(i){try{r=new Date(e),t=r.getTime()}catch(a){try{r=new Date(e.replace(/\//g,"-")),t=r.getTime()}catch(c){return console.error("无法解析日期字符串:",e),null}}}}}}return t/1e3},exports.urlDeconstruction=function(e){const t={},[r,n]=e.split("?");return n&&n.split("&").forEach((e=>{let[r,n]=e.split("=");t[r]=n})),{path:r,query:t}};
