"use strict";const e=require("../common/vendor.js");require("../app/stores/diy.js"),require("../stores/member.js");const i=require("../stores/system.js");require("../stores/config.js");const s=require("../app/api/system.js"),n={name:"新讯理发预约",appid:"__UNI__ED923AB",description:"",versionName:"1.0.0",versionCode:"100",transformPx:!1,"app-plus":{usingComponents:!0,nvueStyleCompiler:"uni-app",compilerVersion:3,splashscreen:{alwaysShowBeforeRender:!0,waiting:!0,autoclose:!0,delay:0},modules:{},distribute:{android:{permissions:['<uses-permission android:name="android.permission.CHANGE_NETWORK_STATE"/>','<uses-permission android:name="android.permission.MOUNT_UNMOUNT_FILESYSTEMS"/>','<uses-permission android:name="android.permission.VIBRATE"/>','<uses-permission android:name="android.permission.READ_LOGS"/>','<uses-permission android:name="android.permission.ACCESS_WIFI_STATE"/>','<uses-feature android:name="android.hardware.camera.autofocus"/>','<uses-permission android:name="android.permission.ACCESS_NETWORK_STATE"/>','<uses-permission android:name="android.permission.CAMERA"/>','<uses-permission android:name="android.permission.GET_ACCOUNTS"/>','<uses-permission android:name="android.permission.READ_PHONE_STATE"/>','<uses-permission android:name="android.permission.CHANGE_WIFI_STATE"/>','<uses-permission android:name="android.permission.WAKE_LOCK"/>','<uses-permission android:name="android.permission.FLASHLIGHT"/>','<uses-feature android:name="android.hardware.camera"/>','<uses-permission android:name="android.permission.WRITE_SETTINGS"/>']},ios:{},sdkConfigs:{}}},quickapp:{},"mp-weixin":{appid:"",setting:{urlCheck:!1},usingComponents:!0,permission:{"scope.userLocation":{desc:"为了更好地为您提供服务"},"scope.writePhotosAlbum":{desc:"为了更好地为您提供服务"}},requiredPrivateInfos:["chooseLocation","getLocation","chooseAddress"],__usePrivacyCheck__:!0},"mp-alipay":{usingComponents:!0},"mp-baidu":{usingComponents:!0},"mp-toutiao":{appid:"ttb99ecf2326972f8a01",usingComponents:!0,setting:{urlCheck:!1}},uniStatistics:{enable:!1},vueVersion:"3",h5:{router:{mode:"history",base:"/wap/"},sdkConfigs:{maps:{qqmap:{key:""}}},async:{loading:"",error:"",delay:0,timeout:3e3}},fallbackLocale:"zh-Hans"};exports.manifestJson=n,exports.useLocation=function(n){const o=i.useSystemStore();let t=n;1!=o.mapConfig.is_open&&(t=!1);const a=()=>{if(!t)return!1;e.index.getStorageSync("manually_select_location_from_map")||o.mapConfig.is_open&&!e.index.getStorageSync("location_address")&&e.index.getLocation({type:"gcj02",success:e=>{let i=e.latitude+","+e.longitude;r(i)},fail:i=>{if(o.defaultPositionAddress="定位失败",i.errno)if(104==i.errno){let i="用户未授权隐私权限，获取位置失败";e.index.showToast({title:i,icon:"none"})}else if(112==i.errno){let i="隐私协议中未声明，获取位置失败";e.index.showToast({title:i,icon:"none"})}if(i.errMsg)if(-1!=i.errMsg.indexOf("getLocation:fail")||-1!=i.errMsg.indexOf("deny")||-1!=i.errMsg.indexOf("denied")){let i="用户未授权获取位置权限，将无法提供服务";e.index.showToast({title:i,icon:"none"})}else e.index.showToast({title:i.errMsg,icon:"none"})}})},r=(i="")=>{if(!t)return!1;let n={latlng:""};n.latlng=i||o.diyAddressInfo.latitude+","+o.diyAddressInfo.longitude,s.getAddressByLatlng(n).then((i=>{if(i.data&&Object.keys(i.data).length){let e={},s=n.latlng.split(",");e.latitude=s[0],e.longitude=s[1],e.full_address=null!=i.data.province?i.data.province:"",e.full_address+=null!=i.data.city?i.data.city:"",e.full_address+=null!=i.data.district?i.data.district:"",e.full_address+=null!=i.data.community?i.data.community:"",e.province_id=i.data.province_id,e.province=i.data.province,e.city_id=i.data.city_id,e.city=i.data.city,e.district_id=i.data.district_id,e.district=i.data.district,e.community=i.data.community,e.formatted_addresses=i.data.formatted_addresses,o.setAddressInfo(e)}else o.setAddressInfo();setTimeout((()=>{e.index.removeStorageSync("manually_select_location_from_map")}),500)}))},d=()=>{let i=e.index.getStorageSync("location_address");if(i){var s=new Date;o.mapConfig.valid_time>0?i.is_expired=s.getTime()/1e3>i.valid_time:i.is_expired=!1}else i={is_expired:!1};return i};return{init:a,onLoad:(i="")=>{e.onLoad((s=>{s&&s.latng&&r(s.latng),e.index.removeStorageSync("manually_select_location_from_map"),"function"==typeof i&&i(s)}))},refresh:()=>{if(!t)return!1;!e.index.getStorageSync("manually_select_location_from_map")&&e.index.getStorageSync("location_address")&&(d()&&!d().is_expired?o.setAddressInfo(e.index.getStorageSync("location_address")):e.index.removeStorageSync("location_address")),!e.index.getStorageSync("manually_select_location_from_map")&&d()&&d().is_expired&&a()},reposition:()=>{if(!t)return!1;let i=o.diyAddressInfo?o.diyAddressInfo.latitude:"",s=o.diyAddressInfo?o.diyAddressInfo.longitude:"";e.index.chooseLocation({latitude:i,longitude:s,success:i=>{e.index.setStorageSync("manually_select_location_from_map",!0);let s=i.latitude+","+i.longitude;r(s)},fail:i=>{if(i.errMsg&&i.errno)if(104==i.errno){let i="用户未授权隐私权限，选择位置失败";e.index.showToast({title:i,icon:"none"})}else if(112==i.errno){let i="隐私协议中未声明，打开地图选择位置失败";e.index.showToast({title:i,icon:"none"})}else e.index.showToast({title:i.errMsg,icon:"none"})}})}}};
