"use strict";const e=require("../common/vendor.js"),a=require("../utils/common.js"),l=require("../app/api/diy.js"),o=require("../app/stores/diy.js");exports.useDiy=function(t={}){const g=e.ref(!0),r=o.useDiyStore(),n=e.ref(0),i=e.ref(t.name||""),d=e.ref(""),u=e.ref(""),p=e.reactive({}),v=e.reactive({pageMode:"diy",title:"",global:{},value:[]}),c=e.computed((()=>"decorate"==r.mode?r:v)),S=e.ref(!1);return{getLoading:()=>g.value,data:c.value,isShowTopTabbar:S,pageStyle:()=>{var e="";return c.value.global.pageStartBgColor&&(c.value.global.pageStartBgColor&&c.value.global.pageEndBgColor?e+=`background:linear-gradient(${c.value.global.pageGradientAngle},${c.value.global.pageStartBgColor},${c.value.global.pageEndBgColor});`:e+="background-color:"+c.value.global.pageStartBgColor+";"),c.value.global.bottomTabBarSwitch?e+="min-height:calc(100vh - 50px);":e+="min-height:calc(100vh);",c.value.global.bgUrl&&(e+=`background-image:url('${a.img(c.value.global.bgUrl)}');`),c.value.global.bgHeightScale&&(e+=`background-size: 100% ${c.value.global.bgHeightScale}%;`),e},onLoad:()=>{e.onLoad((e=>{n.value=e.id||"",""==i.value&&(i.value=e.name||""),d.value=e.template||""}))},onShow:(a=null)=>{e.onShow((()=>{let o=getCurrentPages();u.value=o[o.length-1]?o[o.length-1].route:"";let t=[];e.index.getStorageSync("diyPageBlank")&&(t=e.index.getStorageSync("diyPageBlank")),!t.length||t.length&&-1==t.indexOf(u.value)?r.topFixedStatus="home":t.length&&-1!=t.indexOf(u.value)&&(r.topFixedStatus="diy"),"decorate"==r.mode?r.init():l.getDiyInfo({id:n.value,name:i.value,template:d.value}).then((l=>{if(Object.assign(p,l.data),p.value){v.pageMode=p.mode,v.title=p.title;let a=JSON.parse(p.value);v.global=a.global,v.value=a.value,v.value.forEach(((e,a)=>{e.pageStyle="",e.pageStartBgColor&&(e.pageStartBgColor&&e.pageEndBgColor?e.pageStyle+=`background:linear-gradient(${e.pageGradientAngle},${e.pageStartBgColor},${e.pageEndBgColor});`:e.pageStyle+="background-color:"+e.pageStartBgColor+";"),e.margin&&(e.margin.top>0&&(e.pageStyle+="padding-top:"+2*e.margin.top+"rpx;"),e.pageStyle+="padding-bottom:"+2*e.margin.bottom+"rpx;",e.pageStyle+="padding-right:"+2*e.margin.both+"rpx;",e.pageStyle+="padding-left:"+2*e.margin.both+"rpx;")})),S.value=v.value.some((e=>e&&e.position&&"top_fixed"==e.position)),e.index.setNavigationBarTitle({title:v.title})}g.value=!1,a&&a(p)}))}))},onHide:(a=null)=>{e.onHide((()=>{let l=[];e.index.getStorageSync("diyPageBlank")&&(l=e.index.getStorageSync("diyPageBlank")),l.length&&(l=Array.from(new Set(l)),l.forEach(((e,a,l)=>{e==u.value&&l.splice(a,1)}))),"diy"==r.topFixedStatus&&l.push(u.value),e.index.setStorageSync("diyPageBlank",l),a&&a()}))},onUnload:()=>{e.onUnload((()=>{}))},onPageScroll:()=>{e.onPageScroll((e=>{e.scrollTop>0&&(r.scrollTop=e.scrollTop)}))}}};
