"use strict";const e=require("../../../../../../common/vendor.js"),t=require("../../../../api/order.js");if(require("../../../../../../utils/request.js"),require("../../../../../../stores/member.js"),require("../../../../../../utils/common.js"),require("../../../../../../utils/pages.js"),require("../../../../../../app/stores/diy.js"),require("../../../../../../hooks/useLogin.js"),require("../../../../../../stores/config.js"),require("../../../../../../app/api/auth.js"),require("../../../../../../stores/system.js"),require("../../../../../../app/api/system.js"),require("../../../../../../app/api/member.js"),require("../../../../../../locale/index.js"),require("../../../../../../locale/i18n.js"),require("../../../../../../locale/language.js"),!Array){(e.resolveComponent("u-tabs")+e.resolveComponent("u-button")+e.resolveComponent("u-popup"))()}Math||((()=>"../../../../../../node-modules/uview-plus/components/u-tabs/u-tabs.js")+(()=>"../../../../../../node-modules/uview-plus/components/u-button/u-button.js")+(()=>"../../../../../../node-modules/uview-plus/components/u-popup/u-popup.js"))();const r=e.defineComponent({__name:"select-coupon",props:{orderId:{type:Number,default:0}},emits:["confirm"],setup(r,{expose:o,emit:u}){const s=r,a=e.ref(0),l=e.ref([]),i=e.ref([]),n=e.ref(!1),p=e.ref(null);e.watch((()=>s.orderId),(()=>{s.orderId&&!l.value.length&&t.orderCoupon({order_id:s.orderId}).then((({data:e})=>{const t=[],r=[];e.length&&e.forEach((e=>{e.is_normal?t.push(e):r.push(e)})),i.value=r,l.value=t,t.length&&(p.value=t[0])})).catch()}),{immediate:!0});const m=e.computed((()=>[{name:`可用优惠券（${l.value.length}）`,key:"normal"},{name:`不可用优惠券（${i.value.length}）`,key:"disabled"}])),d=e=>{a.value=e.index},c=()=>{u("confirm",p.value),n.value=!1};return o({open:()=>{n.value=!0},couponList:l}),(t,r)=>e.e({a:!t.type},t.type?{}:{b:e.o(d),c:e.p({list:e.unref(m),current:a.value,itemStyle:"width:50%;height:88rpx;box-sizing: border-box;"})},{d:e.f(l.value,((t,r,o)=>e.e({a:e.t(t.title),b:t.atleast>0},t.atleast>0?{c:e.t(t.atleast)}:{},{d:e.t(t.money),e:p.value&&p.value.id==t.id?1:"",f:e.t(t.create_time),g:e.t(t.expire_time),h:p.value&&p.value.id==t.id?1:"",i:e.o((e=>{return r=t,void(p.value?p.value=p.value.id!=r.id?r:null:p.value=r);var r}))}))),e:0==a.value,f:e.f(i.value,((t,r,o)=>e.e({a:e.t(t.title),b:t.atleast>0},t.atleast>0?{c:e.t(t.atleast)}:{},{d:e.t(t.money),e:e.t(t.create_time),f:e.t(t.expire_time),g:e.t(t.error)}))),g:1==a.value,h:e.o(c),i:e.p({type:"primary",shape:"circle"}),j:e.o((e=>n.value=!1)),k:e.p({show:n.value,mode:"bottom",round:10,closeable:!0})})}});tt.createComponent(r);
