"use strict";const e=require("../../../../../common/vendor.js"),r=require("../../../../../utils/common.js"),n=require("../../../api/merchant.js"),u=require("../../../utils/common.js");require("../../../../../stores/system.js");const a=require("../../../../../app/api/system.js");if(require("../../../../../utils/pages.js"),require("../../../../../app/stores/diy.js"),require("../../../../../hooks/useLogin.js"),require("../../../../../utils/request.js"),require("../../../../../stores/member.js"),require("../../../../../app/api/member.js"),require("../../../../../app/api/auth.js"),require("../../../../../stores/config.js"),require("../../../../../locale/index.js"),require("../../../../../locale/i18n.js"),require("../../../../../locale/language.js"),!Array){(e.resolveComponent("u-icon")+e.resolveComponent("u-loading-page")+e.resolveComponent("u-input")+e.resolveComponent("u-button")+e.resolveComponent("u-popup"))()}Math||((()=>"../../../../../node-modules/uview-plus/components/u-icon/u-icon.js")+(()=>"../../../../../node-modules/uview-plus/components/u-loading-page/u-loading-page.js")+(()=>"../../../../../node-modules/uview-plus/components/u-input/u-input.js")+(()=>"../../../../../node-modules/uview-plus/components/u-button/u-button.js")+(()=>"../../../../../node-modules/uview-plus/components/u-popup/u-popup.js"))();const o=e.defineComponent({__name:"index",setup(o){let t=e.ref({}),l=e.ref({}),s=e.ref({}),i=e.ref({}),c=e.ref({}),f=e.ref(!0),d=e.ref(!1),m=e.ref(0),p=e.ref([{name:"上班中",value:"working",icon:"zzhc icon-shangban"},{name:"用餐中",value:"meal",icon:"zzhc icon-yongcan"},{name:"处理事情中",value:"thing",icon:"zzhc icon-shimang"},{name:"停止接单",value:"stop",icon:"zzhc icon-tingzhi"},{name:"下班休息",value:"rest",icon:"zzhc icon-xiaban"}]),v=e.ref(-1),g=e.ref(0),h=e.ref(""),z=e.ref(""),b=e.ref(""),j=e.ref(!0);e.onLoad((()=>{f.value=!0,m.value=u.currStoreId(),w(),y()}));const w=()=>{n.getBarberInfo(m.value).then((e=>{f.value=!1,t.value=e.data.info,l.value=e.data.work,s.value=e.data.store,i.value=e.data.order_count,c.value=e.data.order_money,l.value&&p.value.forEach(((e,r)=>{e.value==l.value.status&&(v.value=r,g.value=l.value.duration)}))})).catch((n=>{console.log("res",n),e.index.showModal({title:"温馨提示",content:n.msg,confirmText:"切换门店",cancelText:"返回",success:n=>{n.confirm?r.redirect({url:"/addon/zzhc/pages/store/list"}):e.index.navigateBack({delta:1})}})}))},_=e=>{r.redirect({url:"/addon/zzhc/pages/merchant/barber/order/list",param:{status:e}})},q=()=>{if(l.value&&l.value.status==p.value[v.value].value)return wx.showToast({title:"工作状态未改变",icon:"none"}),!1;if(-1==v.value)return wx.showToast({title:"请设置工作状态",icon:"none"}),!1;if((1==v.value||2==v.value)&&""==g.value)return wx.showToast({title:"预计用时不能为空",icon:"none"}),!1;let e={store_id:m.value,status:p.value[v.value].value,duration:g.value,full_address:h.value,latitude:z.value,longitude:b.value};n.barberWorkAdd(e).then((e=>{d.value=!1,w()}))},y=()=>{u.getLoc().then((e=>{console.log(e);let r={latlng:e.latitude+","+e.longitude};z.value=e.latitude,b.value=e.longitude,a.getAddressByLatlng(r).then((e=>{e.data&&Object.keys(e.data).length&&(j.value=!1,h.value=e.data.full_address)}))}),(e=>{console.log("res",e)}))};return(n,u)=>e.e({a:!e.unref(f)},e.unref(f)?{}:e.e({b:e.unref(r.img)(e.unref(t).staff_headimg),c:e.t(e.unref(t).staff_name),d:e.t(e.unref(t).staff_position),e:e.t(e.unref(s).store_name),f:null==e.unref(l)},null==e.unref(l)?{}:{g:e.f(e.unref(p),((r,n,u)=>e.e({a:r.value==e.unref(l).status},r.value==e.unref(l).status?{b:e.n(r.icon)}:{},{c:r.value==e.unref(l).status},r.value==e.unref(l).status?{d:e.t(r.name)}:{},{e:n})))},{h:e.o((r=>e.isRef(d)?d.value=!0:d=!0)),i:e.p({name:"arrow-right",color:"var(--primary-color-dark)",label:"查看",labelSize:"13",labelPos:"left",size:"16"}),j:e.o((n=>e.unref(r.redirect)({url:"/addon/zzhc/pages/merchant/barber/order/list"}))),k:e.unref(r.img)("addon/zzhc/merchant/wait_service.png"),l:e.t(e.unref(i).wait_service_count),m:e.o((e=>_(1))),n:e.unref(r.img)("addon/zzhc/merchant/in_service.png"),o:e.t(e.unref(i).in_service_count),p:e.o((e=>_(2))),q:e.unref(r.img)("addon/zzhc/merchant/wait_pay.png"),r:e.t(e.unref(i).wait_pay_count),s:e.o((e=>_(3))),t:e.t(e.unref(c).all),v:e.t(e.unref(i).finish_count),w:e.t(e.unref(c).today),x:e.t(e.unref(c).month),y:e.unref(r.img)("addon/zzhc/merchant/menu1.png"),z:e.o((r=>e.isRef(d)?d.value=!0:d=!0)),A:e.unref(r.img)("addon/zzhc/merchant/menu2.png"),B:e.o((n=>e.unref(r.redirect)({url:"/addon/zzhc/pages/merchant/barber/work/list"}))),C:e.unref(r.img)("addon/zzhc/merchant/menu4.png"),D:e.o((n=>e.unref(r.redirect)({url:"/addon/zzhc/pages/merchant/barber/order/list"})))}),{E:e.p({"bg-color":"var(--page-bg-color)",loading:e.unref(f),fontSize:"16",color:"var(--primary-color-dark)"}),F:e.f(e.unref(p),((r,n,u)=>e.e({a:e.n(r.icon),b:e.t(r.name),c:n==e.unref(v)},(e.unref(v),{}),{d:e.n(n==e.unref(v)?"ml-auto text-[36rpx] text-color-[var(--primary-color)] zzhc icon-select":"ml-auto text-[36rpx]  zzhc icon-noselect"),e:e.unref(v)==n&&4==e.unref(v)},(e.unref(v)==n&&e.unref(v),{}),{f:e.unref(v)==n&&3==e.unref(v)},(e.unref(v)==n&&e.unref(v),{}),{g:e.unref(v)==n&&(1==e.unref(v)||2==e.unref(v))},e.unref(v)!=n||1!=e.unref(v)&&2!=e.unref(v)?{}:{h:"ab59d62c-3-"+u+",ab59d62c-2",i:e.o((r=>e.isRef(g)?g.value=r:g=r)),j:e.p({type:"number",modelValue:e.unref(g)})},{k:n,l:e.o((e=>(e=>{v.value=e,g.value=0==e||3==e||4==e?0:30})(n)))}))),G:e.t(e.unref(j)?"定位失败":e.unref(h)),H:e.o((r=>{e.isRef(j)?j.value=!0:j=!0,y()})),I:e.o(q),J:e.p({type:"primary",shape:"circle"}),K:e.o((r=>e.isRef(d)?d.value=!1:d=!1)),L:e.p({show:e.unref(d),mode:"bottom",round:10,closeable:!0}),M:e.s(n.themeColor())})}});tt.createPage(o);
