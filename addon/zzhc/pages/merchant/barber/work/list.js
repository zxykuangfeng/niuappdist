"use strict";const e=require("../../../../../../common/vendor.js");require("../../../../../../app/stores/diy.js"),require("../../../../../../stores/member.js"),require("../../../../../../stores/system.js"),require("../../../../../../stores/config.js");const t=require("../../../../api/merchant.js"),r=require("../../../../utils/common.js");if(require("../../../../../../utils/common.js"),require("../../../../../../utils/pages.js"),require("../../../../../../hooks/useLogin.js"),require("../../../../../../utils/request.js"),require("../../../../../../locale/index.js"),require("../../../../../../locale/i18n.js"),require("../../../../../../locale/language.js"),require("../../../../../../app/api/member.js"),require("../../../../../../app/api/auth.js"),require("../../../../../../app/api/system.js"),!Array){(e.resolveComponent("u-popup")+e.resolveComponent("u-loading-page"))()}Math||((()=>"../../../../../../node-modules/uview-plus/components/u-popup/u-popup.js")+(()=>"../../../../../../node-modules/uview-plus/components/u-loading-page/u-loading-page.js"))();const o=e.defineComponent({__name:"list",setup(o){const a=e.reactive({dataCount:[],weekCount:[],curYear:0,curMonth:0,curDate:0,curWeek:0,workInList:[]}),n=e.reactive({weekDay:0,week:0}),u=e.ref(!1);e.ref(!0);const c=e.ref(0);let s=null,l=null;const i=e.ref([]),h=e.ref(!1),d=e.ref("");e.ref([{name:"上班中",value:"working",icon:"zzhc icon-shangban"},{name:"用餐中",value:"meal",icon:"zzhc icon-yongcan"},{name:"处理事情中",value:"thing",icon:"zzhc icon-shimang"},{name:"停止接单",value:"stop",icon:"zzhc icon-tingzhi"},{name:"下班休息",value:"rest",icon:"zzhc icon-xiaban"}]),e.onLoad((()=>{let t=new Date;a.curYear=t.getFullYear(),a.curMonth=t.getMonth(),a.curDate=t.getDate(),a.curWeek=t.getDay(),c.value=r.currStoreId(),0==a.curWeek&&(a.curWeek=7),s=e.toRaw(a.curYear),l=e.toRaw(a.curMonth),g(),m(),p({store_id:c.value,year:a.curYear,month:a.curMonth+1})}));const p=e=>{t.getBarberWorkInfo(e).then((e=>{a.workInList=[],console.log("res.data.length",e.data.length),e.data.days.length&&(a.workInList=e.data.days.map((e=>Number(e))))}))},g=()=>{let e=new Date(a.curYear,a.curMonth+1,0).getDate(),t=new Date(a.curYear,a.curMonth,1).getDay();a.dataCount=[];for(let r=1;r<e+t;r++){let e=r-t+1;a.dataCount.push(e)}},m=()=>{let e=`${a.curYear}-${a.curMonth+1>10?a.curMonth+1:"0"+(a.curMonth+1)}-${a.curDate>10?a.curDate:"0"+a.curDate}`;for(let t=a.curWeek-1;t>=0;t--){const r=new Date(e).getDate()-t;a.weekCount.push(r)}for(let t=1;t<=7-a.curWeek;t++){const r=new Date(e).getDate()+t;a.weekCount.push(r)}},v=e=>{a.dataCount=[],"prev"==e?(a.curMonth--,a.curMonth<0&&(a.curMonth=11,a.curYear--),n.weekDay=1):(a.curMonth++,a.curMonth>11&&(a.curMonth=0,a.curYear++),n.weekDay=1);let t={store_id:r.currStoreId(),year:a.curYear,month:a.curMonth+1};p(t),g()},w=o=>{if(console.log(o),k(o)){d.value=a.curYear+"-"+(a.curMonth+1)+"-"+o;let e={store_id:r.currStoreId(),date:d.value};t.getBarberWorkDateInfo(e).then((e=>{h.value=!0,i.value=e.data}))}else e.index.showToast({title:"无打卡记录",icon:"none"})},k=e=>a.workInList.includes(e),D=e=>e>0&&e<=a.dataCount.length&&(e==a.curDate&&s==a.curYear&&l==a.curMonth||void 0),f=e=>e>0?e:"";return(t,r)=>({a:e.o((e=>v("prev"))),b:e.t(a.curYear),c:e.t(a.curMonth+1),d:e.o((e=>v("next"))),e:e.f(a.dataCount,((t,r,o)=>e.e({a:f(t)},f(t)?e.e({b:e.t(f(t)),c:k(t)},(k(t),{}),{d:k(t)?1:"",e:!k(t)&&t<a.curDate&&a.curMonth+1==(new Date).getMonth()+1&&a.curYear==(new Date).getFullYear()?1:"",f:D(t)?1:"",g:D(t)?"":1,h:e.o((e=>w(t)))}):{},{i:r}))),f:e.t(a.workInList.length),g:e.f(a.workInList,((t,r,o)=>({a:e.t(t),b:r,c:e.o((e=>w(t)))}))),h:e.t(d.value),i:e.f(i.value,((t,r,o)=>({a:e.t(t.status_name),b:e.n(t.status),c:e.t(t.create_time),d:e.t(t.full_address),e:r}))),j:e.o((e=>h.value=!1)),k:e.p({show:h.value,mode:"bottom",round:10,closeable:!0}),l:e.p({"bg-color":"var(--page-bg-color)",loading:u.value,fontSize:"16",color:"var(--primary-color-dark)"}),m:e.s(t.themeColor())})}});tt.createPage(o);
