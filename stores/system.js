"use strict";const e=require("../common/vendor.js"),i=require("../app/api/system.js"),t=require("./config.js"),n=require("./member.js");require("../app/stores/diy.js");const s=e.defineStore("system",{state:()=>({site:null,siteApps:[],siteAddons:[],currRoute:"",mapConfig:{is_open:1,valid_time:0},initStatus:"wait",menuButtonInfo:{height:"",top:"",right:"",width:""},shareCallback:null,defaultPositionAddress:"定位中",diyAddressInfo:null,currTabbar:{path:"",query:{}}}),actions:{getInitFn(s){i.getInitInfo({url:"",openid:e.index.getStorageSync("openid")}).then((i=>{if(i.data){let o=i.data;const a=t.useConfigStore();a.tabbarList=o.tabbar_list,this.mapConfig.is_open=o.map_config.is_open,this.mapConfig.valid_time=o.map_config.valid_time,e.index.setStorageSync("mapConfig",this.mapConfig),e.index.setStorageSync("theme_color_list",o.theme_list),this.site=o.site_info,this.siteApps=o.site_info.app,this.siteAddons=o.site_info.site_addons.map((e=>e.key));n.useMemberStore().levelList=o.member_level,a.login.is_username=o.login_config.is_username,a.login.is_mobile=o.login_config.is_mobile,a.login.is_auth_register=parseInt(o.login_config.is_auth_register),a.login.is_force_access_user_info=parseInt(o.login_config.is_force_access_user_info),a.login.is_bind_mobile=parseInt(o.login_config.is_bind_mobile),a.login.agreement_show=parseInt(o.login_config.agreement_show),a.login.wechat_error=o.login_config.wechat_error,a.login.bg_url=o.login_config.bg_url,a.login.logo=o.login_config.logo,a.login.desc=o.login_config.desc,e.index.setStorageSync("login_config",a.login),e.index.setStorageSync("member_exist",o.member_exist),this.initStatus="finish",e.index.getStorageSync("isBindMobile")&&e.index.removeStorageSync("isBindMobile"),s&&s()}})),this.getMenuButtonInfoFn()},getMenuButtonInfoFn(){this.menuButtonInfo=e.index.getMenuButtonBoundingClientRect()},async getSiteInfoFn(){await i.getSiteInfo().then((e=>{this.site=e.data,this.siteApps=e.data.app,this.siteAddons=e.data.site_addons.map((e=>e.key))})).catch((e=>{}))},setAddressInfo(i={}){let t=e.cloneDeep(i);var n=new Date;n.setSeconds(60*this.mapConfig.valid_time),t.valid_time=n.getTime()/1e3,this.diyAddressInfo?this.diyAddressInfo=Object.assign(this.diyAddressInfo,t):this.diyAddressInfo=t,Object.keys(i).length?e.index.setStorageSync("location_address",t):e.index.removeStorageSync("location_address")}}});exports.useSystemStore=s;
